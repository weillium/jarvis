[{"filePath":"/Users/will-liao/Desktop/Coding/Git/jarvis/worker/context/context-builder.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[237,240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[237,240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `Map<any, any>` assigned to a parameter of type `Map<string, GlossaryEntry>`.","line":20,"column":7,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":20,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `Map<any, any>` assigned to a parameter of type `Map<string, GlossaryEntry>`.","line":39,"column":7,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":39,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":44,"column":25,"nodeType":"Property","messageId":"anyAssignment","endLine":44,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1571,1574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1571,1574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { EventRuntime } from '../types';\nimport type { GlossaryManager } from './glossary-manager';\nimport { countTokens } from '../utils/token-counter';\n\nexport interface AgentContext {\n  bullets: string[];\n  facts: Record<string, any>;\n  glossaryContext: string;\n}\n\nexport class ContextBuilder {\n  constructor(private glossaryManager: GlossaryManager) {}\n\n  buildCardsContext(runtime: EventRuntime, currentChunkText: string): AgentContext {\n    const bullets = runtime.ringBuffer.getContextBullets(10, 2048);\n    const facts = runtime.factsStore.getContextFormat();\n    const combinedText = `${currentChunkText} ${bullets.join(' ')}`;\n    const glossaryTerms = this.glossaryManager.extractRelevantTerms(\n      combinedText,\n      runtime.glossaryCache || new Map()\n    );\n    const glossaryContext = this.glossaryManager.formatGlossaryContext(glossaryTerms);\n\n    return {\n      bullets,\n      facts,\n      glossaryContext,\n    };\n  }\n\n  buildFactsContext(runtime: EventRuntime): {\n    context: AgentContext;\n    recentText: string;\n  } {\n    const recentText = runtime.ringBuffer.getRecentText(20, 2048);\n    const currentFacts = runtime.factsStore.getAll();\n    const glossaryTerms = this.glossaryManager.extractRelevantTerms(\n      recentText,\n      runtime.glossaryCache || new Map()\n    );\n    const glossaryContext = this.glossaryManager.formatGlossaryContext(glossaryTerms);\n\n    const factsRecord = currentFacts.reduce((acc, fact) => {\n      acc[fact.key] = { value: fact.value, confidence: fact.confidence };\n      return acc;\n    }, {} as Record<string, any>);\n\n    return {\n      context: {\n        bullets: [],\n        facts: factsRecord,\n        glossaryContext,\n      },\n      recentText,\n    };\n  }\n\n  getCardsTokenBreakdown(context: AgentContext, currentChunk: string): {\n    total: number;\n    breakdown: Record<string, number>;\n  } {\n    const breakdown: Record<string, number> = {};\n    const ringBufferTokens = countTokens(context.bullets.join('\\n'));\n    const factsTokens = countTokens(JSON.stringify(context.facts));\n    const glossaryTokens = countTokens(context.glossaryContext);\n    const currentChunkTokens = countTokens(currentChunk);\n\n    breakdown.ringBuffer = ringBufferTokens;\n    breakdown.facts = factsTokens;\n    breakdown.glossary = glossaryTokens;\n    breakdown.currentChunk = currentChunkTokens;\n\n    return {\n      total: ringBufferTokens + factsTokens + glossaryTokens + currentChunkTokens,\n      breakdown,\n    };\n  }\n\n  getFactsTokenBreakdown(context: AgentContext, recentText: string): {\n    total: number;\n    breakdown: Record<string, number>;\n  } {\n    const breakdown: Record<string, number> = {};\n    const recentTextTokens = countTokens(recentText);\n    const factsTokens = countTokens(JSON.stringify(context.facts));\n    const glossaryTokens = countTokens(context.glossaryContext);\n\n    breakdown.recentText = recentTextTokens;\n    breakdown.facts = factsTokens;\n    breakdown.glossary = glossaryTokens;\n\n    return {\n      total: recentTextTokens + factsTokens + glossaryTokens,\n      breakdown,\n    };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/will-liao/Desktop/Coding/Git/jarvis/worker/context/pipeline/blueprint-generator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/will-liao/Desktop/Coding/Git/jarvis/worker/context/pipeline/chunks-builder.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'parseError' is defined but never used.","line":542,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":542,"endColumn":24},{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async function 'rankChunks' has no 'await' expression.","line":578,"column":1,"nodeType":"FunctionDeclaration","messageId":"missingAwait","endLine":578,"endColumn":26,"suggestions":[{"messageId":"removeAsync","fix":{"range":[20798,20940],"text":"function rankChunks(\n  chunks: ChunkWithRank[],\n  blueprint: Blueprint,\n  openai: OpenAI,\n  genModel: string\n): ChunkWithRank[]"},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'blueprint' is defined but never used.","line":580,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":580,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'openai' is defined but never used.","line":581,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":581,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'genModel' is defined but never used.","line":582,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":582,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used.","line":594,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":594,"endColumn":48}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Enhanced Chunks Builder\n * Builds ranked context chunks from research results, documents, and LLM generation\n * Stores chunks in context_items table with rank and research_source\n */\n\nimport type { createClient } from '@supabase/supabase-js';\nimport type OpenAI from 'openai';\nimport type { Blueprint } from './blueprint-generator';\nimport type { ResearchResults, ResearchChunkMetadata } from './glossary-builder';\nimport {\n  CONTEXT_CHUNKS_GENERATION_SYSTEM_PROMPT,\n  createContextChunksUserPrompt,\n} from '../../prompts';\nimport {\n  calculateOpenAICost,\n  getPricingVersion,\n} from './pricing-config';\nimport type { OpenAIUsage } from './pricing-config';\n\nexport interface ChunksBuilderOptions {\n  supabase: ReturnType<typeof createClient>;\n  openai: OpenAI;\n  embedModel: string;\n  genModel: string;\n}\n\nexport interface ChunkWithRank {\n  text: string;\n  source: string;\n  research_source: string;\n  rank: number;\n  quality_score?: number;\n  metadata?: ChunkMetadata;\n}\n\ntype ChunkMetadata = ResearchChunkMetadata;\ntype ResearchChunk = ResearchResults['chunks'][number];\n\n/**\n * Build context chunks from blueprint plan, research results, and documents\n * Ranks chunks and stores top N in context_items table\n * Fetches research from research_results table if not provided\n */\nexport interface ChunksCostBreakdown {\n  openai: {\n    total: number;\n    chat_completions: Array<{ cost: number; usage: OpenAIUsage; model: string }>;\n    embeddings: Array<{ cost: number; usage: OpenAIUsage; model: string }>;\n  };\n}\n\nexport interface ChunksBuildResult {\n  chunkCount: number;\n  costBreakdown: ChunksCostBreakdown;\n}\n\ntype SupabaseErrorLike = { message: string } | null;\ntype SupabaseMutationResult = { error: SupabaseErrorLike };\ntype SupabaseListResult<T> = { data: T[] | null; error: SupabaseErrorLike };\ntype IdRow = { id: string };\ntype ResearchResultRecord = {\n  content: string;\n  metadata: ChunkMetadata | null;\n  query: string | null;\n  api: string | null;\n};\ntype ChatCompletionRequest = Parameters<OpenAI['chat']['completions']['create']>[0];\nconst asDbPayload = <T>(payload: T) => payload as unknown as never;\n\nexport async function buildContextChunks(\n  eventId: string,\n  blueprintId: string,\n  generationCycleId: string,\n  blueprint: Blueprint,\n  researchResults: ResearchResults | null,\n  options: ChunksBuilderOptions\n): Promise<ChunksBuildResult> {\n  const { supabase, openai, embedModel, genModel } = options;\n\n  console.log(`[chunks] Building context chunks for event ${eventId}, cycle ${generationCycleId}`);\n  console.log(`[chunks] Target: ${blueprint.chunks_plan.target_count} chunks (${blueprint.chunks_plan.quality_tier} tier)`);\n\n  // Initialize cost tracking\n  const costBreakdown: ChunksCostBreakdown = {\n    openai: {\n      total: 0,\n      chat_completions: [],\n      embeddings: [],\n    },\n  };\n\n  // Fetch research from research_results table if not provided\n  // Exclude research from superseded generation cycles\n  let research: ResearchResults;\n  if (!researchResults) {\n    // First, get all active (non-superseded) generation cycle IDs for research\n    const {\n      data: activeCycles,\n      error: cycleError,\n    }: SupabaseListResult<IdRow> = await supabase\n      .from('generation_cycles')\n      .select('id')\n      .eq('event_id', eventId)\n      .neq('status', 'superseded')\n      .in('cycle_type', ['research']);\n\n    if (cycleError) {\n      console.warn(`[chunks] Warning: Failed to fetch active research cycles: ${cycleError.message}`);\n    }\n\n    // Build list of active cycle IDs\n    const activeCycleIds: string[] = [];\n    if (activeCycles && activeCycles.length > 0) {\n      activeCycleIds.push(...activeCycles.map(c => c.id));\n    }\n\n    // Fetch research results only from active cycles (or legacy items)\n    let researchQuery = supabase\n      .from('research_results')\n      .select('content, metadata, query, api')\n      .eq('event_id', eventId)\n      .eq('blueprint_id', blueprintId);\n\n    if (activeCycleIds.length > 0) {\n      // Include items with null generation_cycle_id OR items from active cycles\n      researchQuery = researchQuery.or(`generation_cycle_id.is.null,generation_cycle_id.in.(${activeCycleIds.join(',')})`);\n    } else {\n      // If no active cycles, only show legacy items (null generation_cycle_id)\n      researchQuery = researchQuery.is('generation_cycle_id', null);\n    }\n\n    const {\n      data: researchData,\n      error: researchError,\n    }: SupabaseListResult<ResearchResultRecord> = await researchQuery;\n\n    if (researchError) {\n      console.warn(`[chunks] Warning: Failed to fetch research results: ${researchError.message}`);\n    }\n\n    research = {\n      chunks: (researchData ?? []).map(item => ({\n        text: item.content,\n        source: item.api || 'research',\n        metadata: item.metadata || undefined,\n      })),\n    };\n  } else {\n    research = researchResults;\n  }\n\n  // Legacy deletion code removed - we now use superseding approach\n  // Old chunks are marked as superseded via generation cycles, not deleted\n\n  // Update generation cycle to processing\n  const { error: processingError }: SupabaseMutationResult = await supabase\n    .from('generation_cycles')\n    .update(asDbPayload({\n      status: 'processing',\n      progress_total: blueprint.chunks_plan.target_count || 500,\n    }))\n    .eq('id', generationCycleId);\n\n  if (processingError) {\n    console.warn(`[chunks] Failed to mark generation cycle as processing: ${processingError.message}`);\n  }\n\n  // 1. Collect chunks from all sources\n  const allChunks: ChunkWithRank[] = [];\n\n  // Add research result chunks\n  for (const chunk of research.chunks) {\n    // Validate chunk text before adding\n    if (!chunk.text || typeof chunk.text !== 'string' || chunk.text.trim().length === 0) {\n      console.warn(`[chunks] Skipping research chunk with invalid text: ${typeof chunk.text}`);\n      continue;\n    }\n    \n    allChunks.push({\n      text: chunk.text.trim(), // Normalize by trimming\n      source: chunk.source || 'research',\n      research_source: chunk.metadata?.api || 'exa',\n      rank: 0, // Will be calculated\n      quality_score: chunk.metadata?.quality_score || 0.8,\n      metadata: chunk.metadata,\n    });\n  }\n\n  // 2. Generate additional LLM chunks if needed (based on chunks plan)\n  const llmChunks = await generateLLMChunks(\n    blueprint,\n    research,\n    openai,\n    genModel,\n    costBreakdown\n  );\n\n  // 2. Add LLM-generated chunks (already validated in generateLLMChunks)\n  for (const chunk of llmChunks) {\n    // Double-check validation (should already be validated, but be safe)\n    if (!chunk || typeof chunk !== 'string' || chunk.trim().length === 0) {\n      console.warn(`[chunks] Skipping LLM chunk with invalid text`);\n      continue;\n    }\n    \n    allChunks.push({\n      text: chunk.trim(), // Ensure trimmed\n      source: 'llm_generation',\n      research_source: 'llm_generation',\n      rank: 0,\n      quality_score: 0.7, // Slightly lower than research\n    });\n  }\n\n  console.log(`[chunks] Collected ${allChunks.length} total chunks from all sources`);\n\n  // 3. Rank chunks by relevance and quality\n  const rankedChunks = await rankChunks(\n    allChunks,\n    blueprint,\n    openai,\n    genModel\n  );\n\n  // 4. Select top N chunks based on target count\n  const targetCount = blueprint.chunks_plan.target_count || 500;\n  const selectedChunks = rankedChunks.slice(0, targetCount);\n\n  console.log(`[chunks] Selected top ${selectedChunks.length} chunks after ranking`);\n\n  // 5. Generate embeddings and store in database\n  let insertedCount = 0;\n  const embeddingBatchSize = 10; // Process embeddings in batches\n\n  for (let i = 0; i < selectedChunks.length; i += embeddingBatchSize) {\n    const batch = selectedChunks.slice(i, i + embeddingBatchSize);\n\n    // Filter out chunks with invalid text\n    const validBatch = batch.filter(chunk => {\n      if (!chunk.text || typeof chunk.text !== 'string' || chunk.text.trim().length === 0) {\n        console.warn(`[chunks] Skipping chunk with invalid text (rank ${chunk.rank}): text is ${typeof chunk.text === 'string' ? 'empty' : 'not a string'}`);\n        return false;\n      }\n      return true;\n    });\n\n    if (validBatch.length === 0) {\n      console.warn(`[chunks] Batch ${i / embeddingBatchSize + 1} has no valid chunks, skipping`);\n      continue;\n    }\n\n    try {\n      // Generate embeddings in parallel\n      // Filter again and validate text is a non-empty string\n      const embeddingBatch = validBatch\n        .map(chunk => {\n          const text = typeof chunk.text === 'string' ? chunk.text.trim() : String(chunk.text || '').trim();\n          return { ...chunk, text };\n        })\n        .filter(chunk => {\n          if (!chunk.text || chunk.text.length === 0) {\n            console.warn(`[chunks] Skipping chunk with empty text after trimming (rank ${chunk.rank})`);\n            return false;\n          }\n          // OpenAI embeddings API has a maximum input length (8191 tokens for text-embedding-3-small)\n          // Rough estimate: 1 token â‰ˆ 4 characters, so max ~32k characters\n          if (chunk.text.length > 32000) {\n            console.warn(`[chunks] Skipping chunk with text too long (${chunk.text.length} chars, rank ${chunk.rank}), truncating`);\n            chunk.text = chunk.text.substring(0, 32000);\n          }\n          return true;\n        });\n\n      if (embeddingBatch.length === 0) {\n        console.warn(`[chunks] Batch ${i / embeddingBatchSize + 1} has no valid chunks after final validation, skipping`);\n        continue;\n      }\n\n      const embeddingPromises = embeddingBatch.map(chunk => {\n        // Double-check that input is a valid non-empty string\n        if (typeof chunk.text !== 'string' || chunk.text.length === 0) {\n          throw new Error(`Invalid chunk text: ${typeof chunk.text} (length: ${chunk.text?.length || 0})`);\n        }\n        return openai.embeddings.create({\n          model: embedModel,\n          input: chunk.text,\n        });\n      });\n\n      const embeddingResponses = await Promise.all(embeddingPromises);\n\n      // Track embedding costs\n      for (const embeddingResponse of embeddingResponses) {\n        if (embeddingResponse.usage) {\n          const usage = embeddingResponse.usage as Partial<OpenAIUsage>;\n          const promptTokens = usage.prompt_tokens ?? 0;\n          const completionTokens = usage.completion_tokens ?? 0;\n          const totalTokens = usage.total_tokens ?? promptTokens + completionTokens;\n          const usageForCost: OpenAIUsage = {\n            prompt_tokens: promptTokens,\n            completion_tokens: completionTokens,\n            total_tokens: totalTokens,\n          };\n          const cost = calculateOpenAICost(usageForCost, embedModel, true); // isEmbedding = true\n          costBreakdown.openai.total += cost;\n          costBreakdown.openai.embeddings.push({\n            cost,\n            usage: {\n              prompt_tokens: promptTokens,\n              completion_tokens: completionTokens,\n              total_tokens: totalTokens,\n            },\n            model: embedModel,\n          });\n        }\n      }\n\n      // Store chunks with embeddings\n      for (let j = 0; j < embeddingBatch.length; j++) {\n        const chunk = embeddingBatch[j];\n        const embeddingResponse = embeddingResponses[j];\n        \n        if (!embeddingResponse || !embeddingResponse.data || !embeddingResponse.data[0]) {\n          console.error(`[chunks] Invalid embedding response for chunk at rank ${chunk.rank}`);\n          continue;\n        }\n        \n        const embedding = embeddingResponse.data[0].embedding;\n\n        try {\n          // Determine component type\n          const componentType = chunk.research_source === 'llm_generation' \n            ? 'llm_generated' \n            : chunk.rank ? 'ranked' : 'research';\n\n          // Build metadata JSONB with all metadata fields\n          const itemMetadata = {\n            ...(chunk.metadata || {}),\n            source: chunk.source,\n            enrichment_source: chunk.research_source,\n            research_source: chunk.research_source,\n            component_type: componentType,\n            quality_score: chunk.quality_score || 0.8,\n            chunk_size: chunk.text.length,\n            enrichment_timestamp: new Date().toISOString(),\n          };\n\n          const { error: insertError }: SupabaseMutationResult = await supabase\n            .from('context_items')\n            .insert(asDbPayload({\n              event_id: eventId,\n              generation_cycle_id: generationCycleId,\n              chunk: chunk.text,\n              embedding: embedding,\n              rank: chunk.rank,\n              metadata: itemMetadata,\n            }));\n\n          if (insertError) {\n            console.error(`[chunks] Error inserting chunk at rank ${chunk.rank}: ${insertError.message}`);\n          } else {\n            insertedCount++;\n            // Update progress\n            const { error: progressError }: SupabaseMutationResult = await supabase\n              .from('generation_cycles')\n              .update(asDbPayload({ progress_current: insertedCount }))\n              .eq('id', generationCycleId);\n\n            if (progressError) {\n              console.warn(`[chunks] Failed to update progress for cycle ${generationCycleId}: ${progressError.message}`);\n            }\n          }\n        // TODO: narrow unknown -> OpenAIAPIError after upstream callsite analysis\n        } catch (error: unknown) {\n          const message = error instanceof Error ? error.message : String(error);\n          console.error(`[chunks] Error processing chunk: ${message}`);\n        }\n      }\n    // TODO: narrow unknown -> OpenAIAPIError after upstream callsite analysis\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : String(error);\n      console.error(`[chunks] Error processing batch: ${message}`);\n      if (typeof error === 'object' && error && 'response' in error) {\n        const response = (error as { response?: { data?: unknown } }).response;\n        if (response?.data) {\n          console.error(`[chunks] OpenAI API error details:`, JSON.stringify(response.data, null, 2));\n        }\n      }\n      // Log the first invalid chunk in the batch for debugging\n      if (validBatch.length > 0) {\n        const firstChunk = validBatch[0];\n        console.error(`[chunks] First chunk in failed batch - type: ${typeof firstChunk.text}, length: ${firstChunk.text?.length || 'N/A'}, text preview: ${String(firstChunk.text || '').substring(0, 100)}`);\n      }\n    }\n  }\n\n  // Calculate total cost and store in cycle metadata\n  const totalCost = costBreakdown.openai.total;\n  const costMetadata = {\n    cost: {\n      total: totalCost,\n      currency: 'USD',\n      breakdown: {\n        openai: {\n          total: costBreakdown.openai.total,\n          chat_completions: costBreakdown.openai.chat_completions,\n          embeddings: costBreakdown.openai.embeddings,\n        },\n      },\n      tracked_at: new Date().toISOString(),\n      pricing_version: getPricingVersion(),\n    },\n  };\n\n  // Mark cycle as completed with cost metadata\n  const { error: cycleUpdateError }: SupabaseMutationResult = await supabase\n    .from('generation_cycles')\n    .update(asDbPayload({\n      status: 'completed',\n      progress_current: insertedCount,\n      completed_at: new Date().toISOString(),\n      metadata: costMetadata,\n    }))\n    .eq('id', generationCycleId);\n\n  if (cycleUpdateError) {\n    console.error(`[chunks] ERROR: Failed to update generation cycle to completed: ${cycleUpdateError.message}`);\n    throw new Error(`Failed to update generation cycle: ${cycleUpdateError.message}`);\n  }\n\n  console.log(`[chunks] Inserted ${insertedCount} context chunks for event ${eventId} (cost: $${totalCost.toFixed(4)})`);\n  console.log(`[chunks] Generation cycle ${generationCycleId} marked as completed`);\n  return {\n    chunkCount: insertedCount,\n    costBreakdown,\n  };\n}\n\n/**\n * Generate additional LLM chunks based on blueprint plan\n */\nasync function generateLLMChunks(\n  blueprint: Blueprint,\n  researchResults: ResearchResults,\n  openai: OpenAI,\n  genModel: string,\n  costBreakdown: ChunksCostBreakdown\n): Promise<string[]> {\n  // Calculate how many LLM chunks we need\n  const targetCount = blueprint.chunks_plan.target_count || 500;\n  const researchChunkCount = researchResults.chunks.length;\n  const neededLLMChunks = Math.max(0, targetCount - researchChunkCount);\n\n  if (neededLLMChunks === 0) {\n    console.log(`[chunks] Research results sufficient, skipping LLM chunk generation`);\n    return [];\n  }\n\n  console.log(`[chunks] Generating ${neededLLMChunks} additional LLM chunks`);\n\n  const systemPrompt = CONTEXT_CHUNKS_GENERATION_SYSTEM_PROMPT;\n\n  const researchSummary = researchResults.chunks\n    .map((chunk: ResearchChunk) => chunk.text)\n    .join('\\n\\n')\n    .substring(0, 3000);\n\n  const blueprintDetails = [\n    `Target chunks: ${neededLLMChunks}`,\n    `Quality tier: ${blueprint.chunks_plan.quality_tier}`,\n    `Inferred topics: ${blueprint.inferred_topics.join(', ')}`\n  ].join('\\n');\n\n  const glossaryHighlights = blueprint.key_terms.slice(0, 10).join(', ');\n\n  const userPrompt = createContextChunksUserPrompt(\n    researchSummary,\n    blueprintDetails,\n    glossaryHighlights\n  );\n\n  try {\n    // Some models (like o1, o1-preview, o1-mini, gpt-5) don't support custom temperature values\n    // Only set temperature if model supports custom values\n    const isO1Model = genModel.startsWith('o1');\n    const onlySupportsDefaultTemp = isO1Model || genModel.includes('gpt-5');\n    const supportsCustomTemperature = !onlySupportsDefaultTemp;\n    \n    // Build request options - conditionally include temperature\n    const requestOptions: ChatCompletionRequest = {\n      model: genModel,\n      messages: [\n        { role: 'system', content: systemPrompt },\n        { role: 'user', content: userPrompt },\n      ],\n      response_format: { type: 'json_object' },\n    };\n    \n    // Only add temperature if model supports custom temperature values\n    if (supportsCustomTemperature) {\n      requestOptions.temperature = 0.7;\n    }\n    \n    const response = await openai.chat.completions.create(\n      requestOptions\n    ) as OpenAI.Chat.Completions.ChatCompletion;\n\n    // Track OpenAI cost for chat completion\n  if (response.usage) {\n    const usage = response.usage as Partial<OpenAIUsage>;\n    const promptTokens = usage.prompt_tokens ?? 0;\n    const completionTokens = usage.completion_tokens ?? 0;\n    const totalTokens = usage.total_tokens ?? promptTokens + completionTokens;\n    const usageForCost: OpenAIUsage = {\n      prompt_tokens: promptTokens,\n      completion_tokens: completionTokens,\n      total_tokens: totalTokens,\n    };\n    const cost = calculateOpenAICost(usageForCost, genModel, false);\n    costBreakdown.openai.total += cost;\n    costBreakdown.openai.chat_completions.push({\n      cost,\n      usage: {\n        prompt_tokens: promptTokens,\n        completion_tokens: completionTokens,\n        total_tokens: totalTokens,\n      },\n      model: genModel,\n      });\n    }\n\n    const content = response.choices[0]?.message?.content;\n    if (!content) {\n      throw new Error('Empty response from LLM');\n    }\n\n    let parsed: unknown;\n    try {\n      parsed = JSON.parse(content);\n    // TODO: narrow unknown -> SyntaxError after upstream callsite analysis\n    } catch (parseError: unknown) {\n      console.error(`[chunks] Failed to parse LLM response as JSON: ${content.substring(0, 200)}`);\n      throw new Error('LLM response is not valid JSON');\n    }\n\n    // Handle both formats: { chunks: [...] } and [...] (array directly)\n    let chunks: unknown[] = [];\n    if (Array.isArray(parsed)) {\n      chunks = parsed;\n    } else if (parsed && Array.isArray((parsed as { chunks?: unknown[] }).chunks)) {\n      chunks = (parsed as { chunks: unknown[] }).chunks ?? [];\n    } else {\n      console.error(`[chunks] Unexpected LLM response format. Parsed:`, JSON.stringify(parsed).substring(0, 200));\n      throw new Error('LLM did not return array of chunks in expected format');\n    }\n\n    // Filter and validate chunks - ensure they are non-empty strings\n    const validChunks = chunks\n      .filter((chunk): chunk is string => typeof chunk === 'string' && chunk.trim().length > 0)\n      .map(chunk => chunk.trim()) // Normalize by trimming\n      .slice(0, neededLLMChunks);\n\n    console.log(`[chunks] Generated ${validChunks.length} valid LLM chunks (filtered ${chunks.length - validChunks.length} invalid)`);\n\n    return validChunks;\n  // TODO: narrow unknown -> OpenAIAPIError after upstream callsite analysis\n  } catch (error: unknown) {\n    const message = error instanceof Error ? error.message : String(error);\n    console.error(`[chunks] Error generating LLM chunks: ${message}`);\n    return [];\n  }\n}\n\n/**\n * Rank chunks by relevance and quality\n */\nasync function rankChunks(\n  chunks: ChunkWithRank[],\n  blueprint: Blueprint,\n  openai: OpenAI,\n  genModel: string\n): Promise<ChunkWithRank[]> {\n  // Simple ranking strategy: combine quality score with source priority\n  // Research results get higher priority, then LLM generation\n  const sourcePriority: Record<string, number> = {\n    'exa': 1.0,\n    'wikipedia': 0.9,\n    'llm_generation': 0.7,\n    'research': 0.8,\n  };\n\n  // Calculate scores for each chunk\n  const scoredChunks = chunks.map((chunk, index) => {\n    const sourceScore = sourcePriority[chunk.research_source] || 0.5;\n    const qualityScore = chunk.quality_score || 0.7;\n    const combinedScore = sourceScore * 0.6 + qualityScore * 0.4;\n\n    return {\n      ...chunk,\n      _score: combinedScore,\n    };\n  });\n\n  // Sort by score (descending) and assign ranks\n  scoredChunks.sort((a, b) => b._score - a._score);\n\n  return scoredChunks.map((chunk, index) => ({\n    ...chunk,\n    rank: index + 1, // Rank 1 = highest\n    _score: undefined, // Remove temporary score\n  } as ChunkWithRank));\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/will-liao/Desktop/Coding/Git/jarvis/worker/context/pipeline/context-generation-orchestrator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GlossaryBuilderOptions' is defined but never used.","line":19,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChunksBuilderOptions' is defined but never used.","line":20,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'calculateExaAnswerCost' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":69,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":82,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":69,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":82,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":69,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":81,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":69,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":71,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2039,2042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2039,2042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .insert on an `any` value.","line":71,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":71,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":81,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":81,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .single on an `any` value.","line":82,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":82,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":85,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":85,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":88,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":88,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":88,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":88,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2827,2830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2827,2830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2919,2922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2919,2922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .completed_at on an `any` value.","line":107,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":107,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":113,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":117,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":113,"column":43,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":117,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":113,"column":43,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":116,"endColumn":10},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":113,"column":43,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":115,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3266,3269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3266,3269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":115,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":115,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":116,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":116,"endColumn":10},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .single on an `any` value.","line":117,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":117,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":119,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":119,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .metadata on an `any` value.","line":119,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":120,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":120,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .metadata on an `any` value.","line":120,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":123,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":127,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":123,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":127,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":123,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":126,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":123,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":125,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3553,3556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3553,3556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":125,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":125,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":126,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":126,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":127,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":127,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":130,"column":95,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":102},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":131,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":131,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":134,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":134,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":156,"column":19,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":156,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":156,"column":43,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":156,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":156,"column":68,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":160,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":156,"column":68,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":159,"endColumn":10},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":156,"column":68,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":158,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4687,4690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4687,4690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":158,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":158,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":159,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":159,"endColumn":10},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .single on an `any` value.","line":160,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":160,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4767,4770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4767,4770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-redundant-type-constituents","severity":2,"message":"'any' overrides all other types in this union type.","line":160,"column":28,"nodeType":"TSAnyKeyword","messageId":"overrides","endLine":160,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4786,4789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4786,4789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":163,"column":69,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .blueprint on an `any` value.","line":166,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":166,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7934,7937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7934,7937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":261,"column":78,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":261,"endColumn":85},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":265,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":268,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":265,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":267,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8166,8169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8166,8169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":267,"column":10,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":267,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":268,"column":10,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":268,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | undefined`.","line":274,"column":67,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":274,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":274,"column":73,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":274,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":281,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":289,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":281,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":288,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":281,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":287,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":281,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":283,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8593,8596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8593,8596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":283,"column":10,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":283,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":285,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":285,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":285,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":285,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":287,"column":10,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":287,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":288,"column":10,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":288,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .in on an `any` value.","line":289,"column":10,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":289,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11023,11026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11023,11026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":359,"column":105,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":359,"endColumn":112},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":393,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":393,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":393,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12455,12458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12455,12458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":393,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":393,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":410,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13007,13010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13007,13010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":411,"column":107,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":411,"endColumn":114},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":423,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13749,13752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13749,13752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":425,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":425,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":425,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":425,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":426,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":426,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":426,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":426,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":426,"column":53,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":426,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":449,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14670,14673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14670,14673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":462,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":462,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15076,15079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15076,15079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .output on an `any` value.","line":463,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":463,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":465,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":465,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":465,"column":33,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":465,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .output on an `any` value.","line":465,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":465,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":468,"column":24,"nodeType":"Property","messageId":"anyAssignment","endLine":468,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .output on an `any` value.","line":468,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":468,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":471,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":471,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .output on an `any` value.","line":471,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":471,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":475,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":475,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .summary on an `any` value.","line":475,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":475,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .content on an `any` value.","line":475,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":475,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .text on an `any` value.","line":475,"column":80,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":475,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":476,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":476,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .keyPoints on an `any` value.","line":476,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":476,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":478,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":478,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":479,"column":107,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":479,"endColumn":113},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":486,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":486,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":486,"column":80,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":486,"endColumn":144},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":486,"column":80,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":486,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":486,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":486,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .join on an `any` value.","line":486,"column":140,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":486,"endColumn":144},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":500,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":511,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":500,"column":29,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":502,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":501,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16644,16647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16644,16647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .insert on an `any` value.","line":502,"column":8,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":502,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":514,"column":94,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":514,"endColumn":101},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":580,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":580,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19716,19719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19716,19719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":637,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21915,21918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21915,21918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":640,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":640,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":640,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":640,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":641,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":641,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":641,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":641,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":643,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":643,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":643,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":643,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":643,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":643,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .response on an `any` value.","line":644,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":644,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .response on an `any` value.","line":644,"column":79,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":644,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":672,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":683,"endColumn":17},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":672,"column":37,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":674,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":673,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":673,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23630,23633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23630,23633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .insert on an `any` value.","line":674,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":674,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":686,"column":102,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":686,"endColumn":109},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":696,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":696,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24410,24413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24410,24413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":698,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":698,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":698,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":698,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":699,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":699,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":699,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":699,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":785,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":785,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28897,28900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28897,28900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":788,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":788,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":788,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":788,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":789,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":789,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":789,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":789,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":791,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":791,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":791,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":791,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":791,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":791,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .response on an `any` value.","line":792,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":792,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .response on an `any` value.","line":792,"column":81,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":792,"endColumn":89},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":793,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":793,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .code on an `any` value.","line":793,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":793,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":799,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":799,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29859,29862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29859,29862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":801,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":801,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":801,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":801,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":802,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":802,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":802,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":802,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":803,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":803,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":803,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":803,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":803,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":803,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":804,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":804,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .code on an `any` value.","line":804,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":804,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":817,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":817,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30960,30963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30960,30963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":820,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":820,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":820,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":820,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":821,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":821,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":821,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":821,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":823,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":823,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":823,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":823,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":823,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":823,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":824,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":824,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .code on an `any` value.","line":824,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":824,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":837,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":837,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31782,31785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31782,31785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":839,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":839,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":839,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":839,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":840,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":840,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":840,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":840,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":841,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":841,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .constructor on an `any` value.","line":841,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":841,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":921,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":921,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34638,34641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34638,34641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":931,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":931,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35130,35133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35130,35133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .temperature on an `any` value.","line":947,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":947,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `ChatCompletionCreateParamsNonStreaming`.","line":950,"column":59,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":950,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":973,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":973,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":974,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":974,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .chunks on an `any` value.","line":974,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":974,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":975,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":975,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36275,36278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36275,36278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":976,"column":69,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":976,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1086,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1098,"endColumn":13},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1086,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1088,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1087,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1087,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39849,39852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39849,39852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .insert on an `any` value.","line":1088,"column":12,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1088,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1101,"column":114,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1101,"endColumn":121},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1115,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1115,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40869,40872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40869,40872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1118,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1118,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1118,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1118,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1119,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1119,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":1119,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1119,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1121,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1121,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1121,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1121,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":1121,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1121,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1122,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1122,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .code on an `any` value.","line":1122,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1122,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .response on an `any` value.","line":1123,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1123,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .response on an `any` value.","line":1123,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1123,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1124,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1124,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .constructor on an `any` value.","line":1124,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1124,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1241,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1253,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1241,"column":35,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1243,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1242,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1242,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45696,45699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45696,45699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .insert on an `any` value.","line":1243,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1243,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1256,"column":119,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1256,"endColumn":126},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1267,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1267,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46607,46610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46607,46610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1270,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":1270,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1270,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1270,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1271,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":1271,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":1271,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1271,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1272,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":1272,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1272,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1272,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":1272,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1272,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1282,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1282,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47322,47325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47322,47325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1285,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1285,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1285,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1285,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1286,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1286,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stack on an `any` value.","line":1286,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1286,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1288,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1288,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1288,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1288,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .statusCode on an `any` value.","line":1288,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1288,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1289,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1289,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .constructor on an `any` value.","line":1289,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1289,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1298,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1298,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47794,47797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47794,47797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .thumbnail on an `any` value.","line":1308,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1308,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .coordinates on an `any` value.","line":1313,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1313,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .extract on an `any` value.","line":1318,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1318,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .extract on an `any` value.","line":1318,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1318,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1330,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1330,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48648,48651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48648,48651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .title on an `any` value.","line":1334,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1334,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .title on an `any` value.","line":1334,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1334,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .author on an `any` value.","line":1339,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1339,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .publishedDate on an `any` value.","line":1344,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1344,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | number | Date`.","line":1346,"column":34,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":1346,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .publishedDate on an `any` value.","line":1346,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1346,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":1354,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1354,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1381,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1384,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1381,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1384,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1381,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1383,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1382,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1382,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49956,49959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49956,49959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":1383,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1383,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1384,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1384,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1387,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1387,"endColumn":68},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1408,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1408,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50695,50698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50695,50698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error_message on an `any` value.","line":1410,"column":12,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1410,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1413,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1416,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1413,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1416,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1413,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1415,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1414,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1414,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50852,50855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50852,50855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":1415,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1415,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1416,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1416,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1419,"column":85,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1419,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":1439,"column":17,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":1439,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":1439,"column":41,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":1439,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1439,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1443,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1439,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1442,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1439,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1441,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1440,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1440,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51643,51646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51643,51646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":1441,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1441,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1442,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1442,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .single on an `any` value.","line":1443,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1443,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1443,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1443,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51717,51720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51717,51720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-redundant-type-constituents","severity":2,"message":"'any' overrides all other types in this union type.","line":1443,"column":26,"nodeType":"TSAnyKeyword","messageId":"overrides","endLine":1443,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1443,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1443,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51736,51739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51736,51739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1446,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1446,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .blueprint on an `any` value.","line":1449,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1449,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1451,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1451,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1452,"column":107,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1452,"endColumn":113},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1481,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1489,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1481,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1489,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1481,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1488,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1481,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1487,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1481,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1486,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1481,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1483,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1482,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1482,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53007,53010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53007,53010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":1483,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1483,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1486,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1486,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1487,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1487,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .neq on an `any` value.","line":1488,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1488,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .in on an `any` value.","line":1489,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1489,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1492,"column":113,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1492,"endColumn":120},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1497,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1504,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1497,"column":49,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1504,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1497,"column":49,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1503,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1497,"column":49,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1502,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1497,"column":49,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1499,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1498,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1498,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53629,53632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53629,53632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":1499,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1499,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1502,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1502,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .in on an `any` value.","line":1503,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1503,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .in on an `any` value.","line":1504,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1504,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1507,"column":113,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1507,"endColumn":120},{"ruleId":"@typescript-eslint/no-base-to-string","severity":2,"message":"'glossaryCount' will use Object's default stringification format ('[object Object]') when stringified.","line":1541,"column":61,"nodeType":"Identifier","messageId":"baseToString","endLine":1541,"endColumn":74},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"GlossaryBuildResult\" of template literal expression.","line":1541,"column":61,"nodeType":"Identifier","messageId":"invalidType","endLine":1541,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1572,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1572,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55834,55837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55834,55837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1573,"column":99,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1573,"endColumn":106},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'researchResults' is defined but never used.","line":1590,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":1590,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":1597,"column":17,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":1597,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":1597,"column":41,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":1597,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1597,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1601,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1597,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1600,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1597,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1599,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1598,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1598,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56772,56775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56772,56775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":1599,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1599,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1600,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1600,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .single on an `any` value.","line":1601,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1601,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1601,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1601,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56846,56849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56846,56849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-redundant-type-constituents","severity":2,"message":"'any' overrides all other types in this union type.","line":1601,"column":26,"nodeType":"TSAnyKeyword","messageId":"overrides","endLine":1601,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1601,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1601,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56865,56868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56865,56868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1604,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1604,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .blueprint on an `any` value.","line":1607,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1607,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1609,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1609,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1610,"column":107,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1610,"endColumn":113},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1646,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1654,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1646,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1654,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1646,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1653,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1646,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1652,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1646,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1651,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1646,"column":47,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1648,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1647,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1647,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58243,58246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58243,58246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":1648,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1648,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1651,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1651,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1652,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1652,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .neq on an `any` value.","line":1653,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1653,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .in on an `any` value.","line":1654,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1654,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1657,"column":113,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1657,"endColumn":120},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'researchResults' is defined but never used.","line":1675,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":1675,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":1682,"column":17,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":1682,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":1682,"column":41,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":1682,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1682,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1686,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1682,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1685,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1682,"column":66,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1684,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1683,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1683,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59371,59374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59371,59374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .select on an `any` value.","line":1684,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1684,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1685,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1685,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .single on an `any` value.","line":1686,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1686,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1686,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1686,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59445,59448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59445,59448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-redundant-type-constituents","severity":2,"message":"'any' overrides all other types in this union type.","line":1686,"column":26,"nodeType":"TSAnyKeyword","messageId":"overrides","endLine":1686,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1686,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1686,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59464,59467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59464,59467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1689,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1689,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .blueprint on an `any` value.","line":1692,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1692,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1694,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1694,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1695,"column":105,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1695,"endColumn":111},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1729,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1737,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1729,"column":45,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1737,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1729,"column":45,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1736,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1729,"column":45,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1735,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1729,"column":45,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1734,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1729,"column":45,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1731,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1730,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1730,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60787,60790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60787,60790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .update on an `any` value.","line":1731,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1731,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1734,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1734,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .eq on an `any` value.","line":1735,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1735,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .neq on an `any` value.","line":1736,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1736,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .in on an `any` value.","line":1737,"column":6,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1737,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1740,"column":109,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1740,"endColumn":116}],"suppressedMessages":[],"errorCount":306,"fatalErrorCount":0,"warningCount":53,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Context Generation Orchestrator\n * Orchestrates the execution of context generation blueprint\n * \n * Flow:\n * 1. Execute research plan (Exa/Wikipedia) â†’ Store in research_results\n * 2. Build glossary â†’ Store with generation_cycle_id\n * 3. Build chunks (ranked, up to 1000) â†’ Store with generation_cycle_id\n * 4. Update status to 'context_complete'\n * \n * Uses generation_cycles for tracking and versioning\n */\n\nimport type { createClient } from '@supabase/supabase-js';\nimport type OpenAI from 'openai';\nimport { Exa } from 'exa-js';\nimport type { Blueprint } from './blueprint-generator';\nimport type { ResearchResults } from './glossary-builder';\nimport { buildGlossary, GlossaryBuilderOptions } from './glossary-builder';\nimport { buildContextChunks, ChunksBuilderOptions } from './chunks-builder';\nimport {\n  STUB_RESEARCH_SYSTEM_PROMPT,\n  createStubResearchUserPrompt,\n} from '../../prompts';\nimport {\n  calculateOpenAICost,\n  calculateExaSearchCost,\n  calculateExaResearchCost,\n  calculateExaAnswerCost,\n  getPricingVersion,\n} from './pricing-config';\n\ntype ExaCostUsage = {\n  searches: number;\n  pages: number;\n  tokens: number;\n};\n\ntype ExaCostBreakdown = {\n  total: number;\n  search: { cost: number; queries: number };\n  research: { cost: number; queries: number; usage: ExaCostUsage };\n  answer: { cost: number; queries: number };\n};\n\ntype ResearchCostTracker = {\n  exa: ExaCostBreakdown;\n};\n\nexport interface ContextGenerationOrchestratorOptions {\n  supabase: ReturnType<typeof createClient>;\n  openai: OpenAI;\n  embedModel: string;\n  genModel: string;\n  exaApiKey?: string; // Optional Exa API key for research\n}\n\n/**\n * Create a generation cycle record\n */\nasync function createGenerationCycle(\n  supabase: ReturnType<typeof createClient>,\n  eventId: string,\n  agentId: string,\n  blueprintId: string,\n  cycleType: 'blueprint' | 'research' | 'glossary' | 'chunks' | 'rankings' | 'embeddings' | 'full',\n  component?: string\n): Promise<string> {\n  const { data, error } = await (supabase\n    .from('generation_cycles') as any)\n    .insert({\n      event_id: eventId,\n      agent_id: agentId,\n      blueprint_id: blueprintId,\n      cycle_type: cycleType,\n      component: component || cycleType,\n      status: 'started',\n      progress_current: 0,\n      progress_total: 0,\n    })\n    .select('id')\n    .single();\n\n  if (error || !data) {\n    throw new Error(`Failed to create generation cycle: ${error?.message || 'Unknown error'}`);\n  }\n\n  return data.id;\n}\n\n/**\n * Update generation cycle status and progress\n */\nasync function updateGenerationCycle(\n  supabase: ReturnType<typeof createClient>,\n  cycleId: string,\n  updates: {\n    status?: 'started' | 'processing' | 'completed' | 'failed' | 'superseded';\n    progress_current?: number;\n    progress_total?: number;\n    error_message?: string;\n    metadata?: any; // For storing cost data and other metadata\n  }\n): Promise<void> {\n  const updateData: any = { ...updates };\n  if (updates.status === 'completed') {\n    updateData.completed_at = new Date().toISOString();\n  }\n\n  // If metadata is provided, merge with existing metadata\n  if (updates.metadata !== undefined) {\n    // Fetch existing metadata first\n    const { data: existingCycle } = await (supabase\n      .from('generation_cycles') as any)\n      .select('metadata')\n      .eq('id', cycleId)\n      .single();\n\n    const existingMetadata = existingCycle?.metadata || {};\n    updateData.metadata = { ...existingMetadata, ...updates.metadata };\n  }\n\n  const { error, data } = await (supabase\n    .from('generation_cycles') as any)\n    .update(updateData)\n    .eq('id', cycleId)\n    .select('id');\n\n  if (error) {\n    console.error(`[context-gen] ERROR: Failed to update generation cycle ${cycleId}: ${error.message}`);\n    throw new Error(`Failed to update generation cycle: ${error.message}`);\n  }\n\n  if (!data || data.length === 0) {\n    console.warn(`[context-gen] WARNING: Generation cycle ${cycleId} not found or update affected 0 rows`);\n  } else if (updates.status === 'completed') {\n    console.log(`[context-gen] Generation cycle ${cycleId} marked as completed`);\n  }\n}\n\n/**\n * Execute context generation based on approved blueprint\n */\nexport async function executeContextGeneration(\n  eventId: string,\n  agentId: string,\n  blueprintId: string,\n  options: ContextGenerationOrchestratorOptions\n): Promise<void> {\n  const { supabase, openai, embedModel, genModel } = options;\n\n  console.log(`[context-gen] Executing context generation for event ${eventId}, agent ${agentId}, blueprint ${blueprintId}`);\n\n  try {\n    // 1. Fetch blueprint\n    const { data: blueprintRecord, error: blueprintError } = await (supabase\n      .from('context_blueprints') as any)\n      .select('*')\n      .eq('id', blueprintId)\n      .single() as { data: any | null; error: any };\n\n    if (blueprintError || !blueprintRecord) {\n      throw new Error(`Failed to fetch blueprint: ${blueprintError?.message || 'Blueprint not found'}`);\n    }\n\n    const blueprint = blueprintRecord.blueprint as Blueprint;\n\n    // 2. Update status to 'researching'\n    await updateAgentStatus(supabase, agentId, 'researching');\n    // Blueprint status stays 'approved' - execution tracked via agent status and generation_cycles\n\n    // 3. Create research generation cycle\n    const researchCycleId = await createGenerationCycle(\n      supabase,\n      eventId,\n      agentId,\n      blueprintId,\n      'research',\n      'research'\n    );\n\n    // 4. Execute research plan and store in research_results\n    console.log(`[context-gen] Executing research plan with ${blueprint.research_plan.queries.length} queries`);\n    const researchResults = await executeResearchPlan(\n      eventId,\n      blueprintId,\n      blueprint,\n      researchCycleId,\n      { supabase, openai, genModel, exaApiKey: options.exaApiKey }\n    );\n\n    console.log(`[context-gen] Research completed: ${researchResults.chunks.length} chunks found`);\n\n    // 5. Create glossary generation cycle\n    const glossaryCycleId = await createGenerationCycle(\n      supabase,\n      eventId,\n      agentId,\n      blueprintId,\n      'glossary',\n      'glossary'\n    );\n\n    // 6. Update status to 'building_glossary'\n    await updateAgentStatus(supabase, agentId, 'building_glossary');\n\n    // 7. Build glossary (fetches research from research_results table)\n    const glossaryResult = await buildGlossary(\n      eventId,\n      blueprintId,\n      glossaryCycleId,\n      blueprint,\n      null, // Pass null to fetch from research_results table\n      {\n        supabase,\n        openai,\n        genModel,\n        embedModel,\n        exaApiKey: options.exaApiKey,\n      }\n    );\n\n    console.log(`[context-gen] Glossary built: ${glossaryResult.termCount} terms (cost: $${(glossaryResult.costBreakdown.openai.total + glossaryResult.costBreakdown.exa.total).toFixed(4)})`);\n\n    // 8. Create chunks generation cycle\n    const chunksCycleId = await createGenerationCycle(\n      supabase,\n      eventId,\n      agentId,\n      blueprintId,\n      'chunks',\n      'llm_chunks'\n    );\n\n    // 9. Update status to 'building_chunks'\n    await updateAgentStatus(supabase, agentId, 'building_chunks');\n\n    // 10. Build chunks (fetches research from research_results table)\n    const chunksResult = await buildContextChunks(\n      eventId,\n      blueprintId,\n      chunksCycleId,\n      blueprint,\n      null, // Pass null to fetch from research_results table\n      {\n        supabase,\n        openai,\n        embedModel,\n        genModel,\n      }\n    );\n\n    console.log(`[context-gen] Context chunks built: ${chunksResult.chunkCount} chunks (cost: $${chunksResult.costBreakdown.openai.total.toFixed(4)})`);\n\n    // 8. Update status to 'context_complete'\n    await updateAgentStatus(supabase, agentId, 'context_complete');\n    // Blueprint status stays 'approved' - completion tracked via agent status\n\n    console.log(`[context-gen] Context generation complete for event ${eventId}`);\n  } catch (error: any) {\n    console.error(`[context-gen] Error executing context generation: ${error.message}`);\n    \n    // Update status to error (status='error', stage remains unchanged)\n    try {\n      await (supabase\n        .from('agents') as any)\n        .update({ status: 'error' })\n        .eq('id', agentId);\n    } catch {\n      // Ignore errors updating agent status\n    }\n    \n    try {\n      await updateBlueprintStatus(supabase, blueprintId, 'error', error.message);\n    } catch {\n      // Ignore errors updating blueprint status\n    }\n    \n    // Mark any active generation cycles as failed\n    try {\n      await (supabase\n        .from('generation_cycles') as any)\n        .update({\n          status: 'failed',\n          error_message: error.message,\n        })\n        .eq('event_id', eventId)\n        .eq('agent_id', agentId)\n        .in('status', ['started', 'processing']);\n    } catch {\n      // Ignore errors updating generation cycles\n    }\n    \n    throw error;\n  }\n}\n\n/**\n * Pending research task tracking\n */\ninterface PendingResearchTask {\n  researchId: string;\n  queryItem: { query: string; api: string; priority: number };\n  queryNumber: number;\n  queryProgress: string;\n  createdAt: number; // Timestamp when task was created\n  startTime: number; // For timing\n}\n\n/**\n * Poll for research task completion\n * Per Exa docs: https://docs.exa.ai/reference/research/get-a-task\n * Polls up to 5 minutes per task, checking every 5-10 seconds\n */\nasync function pollResearchTasks(\n  exa: Exa,\n  pendingTasks: PendingResearchTask[],\n  supabase: ReturnType<typeof createClient>,\n  eventId: string,\n  blueprintId: string,\n  generationCycleId: string,\n  chunks: ResearchResults['chunks'],\n  insertedCount: { value: number },\n  costBreakdown: ResearchCostTracker\n): Promise<void> {\n  const MAX_POLL_TIME_MS = 5 * 60 * 1000; // 5 minutes per task\n  const POLL_INTERVAL_MS = 10000; // Poll every 10 seconds (per Exa docs, status checks are not billable)\n  \n  const activeTasks = [...pendingTasks]; // Clone array\n  const startTime = Date.now();\n  \n  console.log(`[research-poll] Polling ${activeTasks.length} research task(s) (max ${MAX_POLL_TIME_MS / 1000}s per task, interval ${POLL_INTERVAL_MS / 1000}s)`);\n  \n  while (activeTasks.length > 0) {\n    // Check each active task\n    for (let i = activeTasks.length - 1; i >= 0; i--) {\n      const task = activeTasks[i];\n      const taskAge = Date.now() - task.createdAt;\n      \n      // Check if task has exceeded max poll time\n      if (taskAge > MAX_POLL_TIME_MS) {\n        console.warn(`[research-poll] ${task.queryProgress} Task ${task.researchId} exceeded max poll time (${MAX_POLL_TIME_MS / 1000}s), falling back to /search`);\n        activeTasks.splice(i, 1); // Remove from active list\n        \n        // Fallback to /search\n        try {\n          await executeExaSearch(\n            task.queryItem,\n            exa,\n            supabase,\n            eventId,\n            blueprintId,\n            generationCycleId,\n            chunks,\n            insertedCount,\n            costBreakdown\n          );\n        } catch (searchError: any) {\n          console.error(`[research-poll] ${task.queryProgress} âœ— Fallback /search FAILED:`, searchError.message);\n        }\n        continue;\n      }\n      \n      try {\n        // Get task status (per Exa docs: https://docs.exa.ai/reference/research/get-a-task)\n        const taskStatus = await exa.research.get(task.researchId);\n        \n        if (taskStatus.status === 'completed' && taskStatus.output) {\n          const duration = Date.now() - task.startTime;\n          console.log(`[research-poll] ${task.queryProgress} âœ“ Exa /research completed in ${duration}ms for query: \"${task.queryItem.query}\"`);\n          \n          // Process completed research result\n          await processCompletedResearchTask(\n            task,\n            taskStatus,\n            exa,\n            supabase,\n            eventId,\n            blueprintId,\n            generationCycleId,\n            chunks,\n            insertedCount,\n            costBreakdown\n          );\n          \n          activeTasks.splice(i, 1); // Remove from active list\n        } else if (taskStatus.status === 'failed') {\n          const duration = Date.now() - task.startTime;\n          console.error(`[research-poll] ${task.queryProgress} âœ— Exa /research task FAILED for query \"${task.queryItem.query}\":`, {\n            status: taskStatus.status,\n            researchId: task.researchId,\n            duration: `${duration}ms`,\n            error: (taskStatus as any).error || 'Unknown error',\n          });\n          \n          // Fallback to /search\n          console.log(`[research-poll] ${task.queryProgress} Falling back to Exa /search for query: \"${task.queryItem.query}\"`);\n          try {\n            await executeExaSearch(\n              task.queryItem,\n              exa,\n              supabase,\n              eventId,\n              blueprintId,\n              generationCycleId,\n              chunks,\n              insertedCount,\n              costBreakdown\n            );\n          } catch (searchError: any) {\n            console.error(`[research-poll] ${task.queryProgress} âœ— Fallback /search FAILED:`, searchError.message);\n          }\n          \n          activeTasks.splice(i, 1); // Remove from active list\n        } else if (taskStatus.status === 'canceled') {\n          console.warn(`[research-poll] ${task.queryProgress} Task ${task.researchId} was canceled`);\n          activeTasks.splice(i, 1); // Remove from active list\n        } else {\n          // Still running (pending or running status)\n          const taskAgeSeconds = Math.floor(taskAge / 1000);\n          console.log(`[research-poll] ${task.queryProgress} Task ${task.researchId} still ${taskStatus.status} (${taskAgeSeconds}s elapsed)`);\n        }\n      } catch (pollError: any) {\n        console.error(`[research-poll] ${task.queryProgress} âœ— Error polling task ${task.researchId}:`, {\n          error: pollError.message,\n          statusCode: pollError.status || pollError.statusCode || 'N/A',\n        });\n        // Continue polling this task (don't remove from active list)\n      }\n    }\n    \n    // If there are still active tasks, wait before next poll\n    if (activeTasks.length > 0) {\n      await new Promise(resolve => setTimeout(resolve, POLL_INTERVAL_MS));\n    }\n  }\n  \n  const totalDuration = Date.now() - startTime;\n  console.log(`[research-poll] ========================================`);\n  console.log(`[research-poll] Polling complete in ${totalDuration}ms`);\n  console.log(`[research-poll] ========================================`);\n}\n\n/**\n * Process a completed research task result\n */\nasync function processCompletedResearchTask(\n  task: PendingResearchTask,\n  taskStatus: any,\n  exa: Exa,\n  supabase: ReturnType<typeof createClient>,\n  eventId: string,\n  blueprintId: string,\n  generationCycleId: string,\n  chunks: ResearchResults['chunks'],\n  insertedCount: { value: number },\n  costBreakdown: ResearchCostTracker\n): Promise<void> {\n  const { queryItem, queryProgress } = task;\n  \n  // Extract structured output from research (with outputSchema, it's JSON)\n  let researchData: any;\n  if (typeof taskStatus.output === 'string') {\n    try {\n      researchData = JSON.parse(taskStatus.output);\n    } catch {\n      // If not JSON, treat as plain text\n      researchData = { summary: taskStatus.output, keyPoints: [] };\n    }\n  } else {\n    researchData = taskStatus.output;\n  }\n  \n  // Extract summary and key points from structured output\n  const summary = researchData.summary || researchData.content || researchData.text || '';\n  const keyPoints = researchData.keyPoints || [];\n  \n  if (!summary || summary.length < 50) {\n    console.warn(`[research-poll] ${queryProgress} Exa /research output is empty or too short (${summary?.length || 0} chars) for query: \"${queryItem.query}\" - falling back to /search`);\n    // Fallback to /search\n    await executeExaSearch(queryItem, exa, supabase, eventId, blueprintId, generationCycleId, chunks, insertedCount, costBreakdown);\n    return;\n  }\n  \n  // Combine summary and key points into research text\n  const researchText = summary + (keyPoints.length > 0 ? '\\n\\nKey Points:\\n' + keyPoints.map((kp: string, i: number) => `${i + 1}. ${kp}`).join('\\n') : '');\n  \n  // Split comprehensive research output into chunks\n  const textChunks = chunkTextContent(researchText, 200, 400);\n  \n  for (const chunkText of textChunks) {\n    const metadata = {\n      api: 'exa',\n      query: queryItem.query,\n      research_id: task.researchId,\n      method: 'research',\n      quality_score: 0.95, // High quality for comprehensive research\n    };\n\n    const { error } = await (supabase\n      .from('research_results') as any)\n      .insert({\n        event_id: eventId,\n        blueprint_id: blueprintId,\n        generation_cycle_id: generationCycleId,\n        query: queryItem.query,\n        api: 'exa',\n        content: chunkText,\n        quality_score: metadata.quality_score,\n        metadata: metadata,\n      });\n\n    if (error) {\n      console.error(`[research-poll] ${queryProgress} Error storing research result: ${error.message}`);\n    } else {\n      insertedCount.value++;\n      chunks.push({\n        text: chunkText,\n        source: 'exa_research',\n        metadata,\n      });\n    }\n  }\n\n  const totalDuration = Date.now() - task.startTime;\n  console.log(`[research-poll] ${queryProgress} âœ“ Stored ${textChunks.length} chunks from Exa /research in ${totalDuration}ms for query: \"${queryItem.query}\"`);\n  \n  // Track Exa research cost (estimate based on typical usage)\n  // Note: Exa research cost is variable, we estimate based on typical usage\n  // If Exa provides usage data in response, we can use that\n  // Estimate: typical research uses ~5 searches, ~3 pages, ~50k tokens\n  const estimatedUsage = {\n    searches: 5,\n    pages: 3,\n    tokens: 50000,\n  };\n  const researchCost = calculateExaResearchCost(estimatedUsage);\n  costBreakdown.exa.total += researchCost;\n  costBreakdown.exa.research.cost += researchCost;\n  costBreakdown.exa.research.queries += 1;\n  costBreakdown.exa.research.usage.searches += estimatedUsage.searches;\n  costBreakdown.exa.research.usage.pages += estimatedUsage.pages;\n  costBreakdown.exa.research.usage.tokens += estimatedUsage.tokens;\n}\n\n/**\n * Execute research plan from blueprint and store in research_results table\n * Uses Exa API for deep research queries\n * \n * NEW APPROACH:\n * 1. Start all Exa /research tasks (fire-and-forget)\n * 2. Process Wikipedia and Exa /search queries immediately\n * 3. Poll for /research task completion in background (up to 5 minutes)\n * 4. Process results as they complete\n */\nasync function executeResearchPlan(\n  eventId: string,\n  blueprintId: string,\n  blueprint: Blueprint,\n  generationCycleId: string,\n  options: { supabase: ReturnType<typeof createClient>; openai: OpenAI; genModel: string; exaApiKey?: string }\n): Promise<ResearchResults> {\n  const { supabase, openai, genModel, exaApiKey } = options;\n  const queries = blueprint.research_plan.queries || [];\n\n  console.log(`[research] ========================================`);\n  console.log(`[research] Starting research plan execution`);\n  console.log(`[research] Total queries: ${queries.length}`);\n  console.log(`[research] Event ID: ${eventId}, Blueprint ID: ${blueprintId}, Cycle ID: ${generationCycleId}`);\n  console.log(`[research] ========================================`);\n\n  const chunks: ResearchResults['chunks'] = [];\n  const insertedCount = { value: 0 }; // Use object to allow mutation in helper function\n  const pendingResearchTasks: PendingResearchTask[] = []; // Track async research tasks\n\n  // Initialize cost tracking\n  const costBreakdown = {\n    openai: {\n      total: 0,\n      chat_completions: [] as Array<{ cost: number; usage: any; model: string }>,\n    },\n    exa: {\n      total: 0,\n      search: { cost: 0, queries: 0 },\n      research: { cost: 0, queries: 0, usage: { searches: 0, pages: 0, tokens: 0 } },\n      answer: { cost: 0, queries: 0 },\n    },\n  };\n\n  // Initialize Exa client if API key is provided\n  const exa = exaApiKey ? new Exa(exaApiKey) : null;\n  if (!exa && queries.some(q => q.api === 'exa')) {\n    console.warn(`[research] âš ï¸  Exa API key not provided, but ${queries.filter(q => q.api === 'exa').length} Exa queries found. Falling back to LLM stub.`);\n  }\n  \n  const exaQueries = queries.filter(q => q.api === 'exa').length;\n  const wikipediaQueries = queries.filter(q => q.api === 'wikipedia').length;\n  console.log(`[research] Query breakdown: ${exaQueries} Exa queries, ${wikipediaQueries} Wikipedia queries`);\n\n  // Update cycle to processing\n  await updateGenerationCycle(supabase, generationCycleId, {\n    status: 'processing',\n    progress_total: queries.length,\n  });\n\n  // Process queries\n  for (let i = 0; i < queries.length; i++) {\n    const queryItem = queries[i];\n    const queryNumber = i + 1;\n    const queryProgress = `[${queryNumber}/${queries.length}]`;\n    \n    console.log(`[research] ${queryProgress} Starting query: \"${queryItem.query}\" (API: ${queryItem.api}, Priority: ${queryItem.priority})`);\n    \n    try {\n      if (queryItem.api === 'wikipedia') {\n        // Wikipedia API implementation\n        console.log(`[research] ${queryProgress} Executing Wikipedia API request for: ${queryItem.query}`);\n        const startTime = Date.now();\n        \n        try {\n          const wikipediaChunks = await executeWikipediaSearch(\n            queryItem.query,\n            supabase,\n            eventId,\n            blueprintId,\n            generationCycleId\n          );\n          \n          const duration = Date.now() - startTime;\n          \n          for (const chunk of wikipediaChunks) {\n            insertedCount.value++;\n            chunks.push(chunk);\n          }\n          \n          console.log(`[research] ${queryProgress} âœ“ Wikipedia API success: ${wikipediaChunks.length} chunks created in ${duration}ms for query: \"${queryItem.query}\"`);\n        } catch (wikipediaError: any) {\n          const duration = Date.now() - startTime;\n          console.error(`[research] ${queryProgress} âœ— Wikipedia API FAILURE for query \"${queryItem.query}\":`, {\n            error: wikipediaError.message,\n            stack: wikipediaError.stack,\n            duration: `${duration}ms`,\n            statusCode: wikipediaError.status || wikipediaError.statusCode || 'N/A',\n            response: wikipediaError.response ? JSON.stringify(wikipediaError.response).substring(0, 200) : 'N/A',\n          });\n          // Continue with other queries even if one fails\n        }\n        \n        // Update progress after Wikipedia query\n        await updateGenerationCycle(supabase, generationCycleId, {\n          progress_current: queryNumber,\n        });\n        continue;\n      } else if (queryItem.api === 'exa') {\n        if (!exa) {\n          // Fallback to stub if Exa API key not available\n          console.warn(`[research] ${queryProgress} Exa API key not available - using LLM stub fallback for query: \"${queryItem.query}\"`);\n          const startTime = Date.now();\n          \n          try {\n            const stubChunks = await generateStubResearchChunks(queryItem.query, openai, genModel, costBreakdown);\n            const duration = Date.now() - startTime;\n            console.log(`[research] ${queryProgress} LLM stub generated ${stubChunks.length} chunks in ${duration}ms for query: \"${queryItem.query}\"`);\n          \n          for (const chunkText of stubChunks) {\n            const metadata = {\n              api: 'exa',\n              query: queryItem.query,\n              quality_score: 0.7,\n            };\n\n            const { error } = await (supabase\n              .from('research_results') as any)\n              .insert({\n                event_id: eventId,\n                blueprint_id: blueprintId,\n                generation_cycle_id: generationCycleId,\n                query: queryItem.query,\n                api: 'llm_stub',\n                content: chunkText,\n                quality_score: metadata.quality_score,\n                metadata: metadata,\n              });\n\n            if (error) {\n              console.error(`[research] ${queryProgress} Database error storing stub result: ${error.message}`);\n            } else {\n              insertedCount.value++;\n              chunks.push({\n                text: chunkText,\n                source: 'research_stub',\n                metadata,\n              });\n            }\n          }\n          } catch (stubError: any) {\n            console.error(`[research] ${queryProgress} âœ— LLM stub generation FAILURE for query \"${queryItem.query}\":`, {\n              error: stubError.message,\n              stack: stubError.stack,\n            });\n          }\n        } else {\n          // Use /research endpoint for high-priority queries (priority 1-2)\n          if (queryItem.priority <= 2) {\n            console.log(`[research] ${queryProgress} Using Exa /research endpoint for high-priority query (priority ${queryItem.priority}): \"${queryItem.query}\"`);\n            const startTime = Date.now();\n            \n            try {\n              // Create comprehensive research task\n              // OPTIMIZATION: Use outputSchema to constrain scope and reduce searches/pages\n              // OPTIMIZATION: Make instructions explicit and scoped per Exa best practices\n              console.log(`[research] ${queryProgress} Creating Exa research task (will poll in background)...`);\n              \n              // Constrain output with schema to reduce cost (Exa best practice: 1-5 root fields)\n              // This helps the agent understand scope and reduces unnecessary searches/page reads\n              const outputSchema = {\n                type: 'object',\n                required: ['summary', 'keyPoints'],\n                properties: {\n                  summary: {\n                    type: 'string',\n                    description: 'A comprehensive summary (500-1000 words) covering the main topic'\n                  },\n                  keyPoints: {\n                    type: 'array',\n                    items: { type: 'string' },\n                    maxItems: 10,\n                    description: 'Key insights, developments, or findings (1-2 sentences each)'\n                  }\n                },\n                additionalProperties: false\n              };\n              \n              // Make instructions explicit and scoped (Exa best practice)\n              // Specify: (1) what information (2) how to find it (3) how to compose report\n              const instructions = `Research the topic: \"${queryItem.query}\"\n\nOBJECTIVE: Provide a structured summary with key points suitable for AI context building.\n\nWHAT TO FIND:\n- Latest developments and current state (2023-2025 focus)\n- Industry standards and best practices\n- Key insights and practical applications\n- Relevant technical details and methodologies\n\nHOW TO RESEARCH:\n- Use 3-5 targeted searches to find authoritative sources\n- Focus on recent, high-quality publications and official documentation\n- Prioritize comprehensive overview sources over narrow niche articles\n\nHOW TO COMPOSE:\n- Write a concise summary (500-1000 words) synthesizing findings\n- Extract 8-10 key points as separate insights\n- Include citations for important claims\n- Focus on actionable information relevant to the topic`;\n\n              // Create research task (returns immediately, doesn't wait for completion)\n              // Per Exa docs: https://docs.exa.ai/reference/research/create-a-task\n              const research = await exa.research.create({\n                model: 'exa-research', // Use standard model (exa-research-pro is 2x more expensive)\n                instructions: instructions,\n                outputSchema: outputSchema, // Constrains agent scope, reduces searches/pages\n              });\n\n              console.log(`[research] ${queryProgress} âœ“ Exa research task created: ${research.researchId}, status: ${research.status}. Will poll in background.`);\n              console.log(`[research] ${queryProgress} Note: Research uses variable pricing ($5/1k searches, $5/1k pages, $5/1M reasoning tokens). OutputSchema helps constrain scope.`);\n\n              // Store task for background polling (don't block here)\n              pendingResearchTasks.push({\n                researchId: research.researchId,\n                queryItem,\n                queryNumber,\n                queryProgress,\n                createdAt: Date.now(),\n                startTime,\n              });\n              \n              // Update progress immediately (task started, not completed)\n              await updateGenerationCycle(supabase, generationCycleId, {\n                progress_current: queryNumber,\n              });\n              \n              console.log(`[research] ${queryProgress} Moving on to next query while research task runs in background...`);\n              continue; // Continue to next query immediately\n            } catch (researchError: any) {\n              const duration = Date.now() - startTime;\n              console.error(`[research] ${queryProgress} âœ— Exa /research task creation FAILURE for query \"${queryItem.query}\":`, {\n                error: researchError.message,\n                stack: researchError.stack,\n                duration: `${duration}ms`,\n                statusCode: researchError.status || researchError.statusCode || 'N/A',\n                response: researchError.response ? JSON.stringify(researchError.response).substring(0, 200) : 'N/A',\n                code: researchError.code || 'N/A',\n              });\n              console.log(`[research] ${queryProgress} Attempting fallback to Exa /search for query: \"${queryItem.query}\"`);\n              // Fallback to /search\n              try {\n                await executeExaSearch(queryItem, exa, supabase, eventId, blueprintId, generationCycleId, chunks, insertedCount, costBreakdown);\n              } catch (searchError: any) {\n                console.error(`[research] ${queryProgress} âœ— Fallback Exa /search also FAILED for query \"${queryItem.query}\":`, {\n                  error: searchError.message,\n                  stack: searchError.stack,\n                  statusCode: searchError.status || searchError.statusCode || 'N/A',\n                  code: searchError.code || 'N/A',\n                });\n              }\n            }\n          } else {\n            // Use /search endpoint for priority 3+ queries (current implementation)\n            console.log(`[research] ${queryProgress} Using Exa /search endpoint for query (priority ${queryItem.priority}): \"${queryItem.query}\"`);\n            const startTime = Date.now();\n            \n            try {\n              await executeExaSearch(queryItem, exa, supabase, eventId, blueprintId, generationCycleId, chunks, insertedCount, costBreakdown);\n              const duration = Date.now() - startTime;\n              console.log(`[research] ${queryProgress} âœ“ Exa /search completed in ${duration}ms for query: \"${queryItem.query}\"`);\n            } catch (searchError: any) {\n              const duration = Date.now() - startTime;\n              console.error(`[research] ${queryProgress} âœ— Exa /search FAILURE for query \"${queryItem.query}\":`, {\n                error: searchError.message,\n                stack: searchError.stack,\n                duration: `${duration}ms`,\n                statusCode: searchError.status || searchError.statusCode || 'N/A',\n                code: searchError.code || 'N/A',\n              });\n            }\n          }\n        }\n      }\n\n      // Update progress after successful query processing\n      await updateGenerationCycle(supabase, generationCycleId, {\n        progress_current: queryNumber,\n      });\n      \n      console.log(`[research] ${queryProgress} Query processing complete. Total chunks so far: ${insertedCount.value}`);\n    } catch (error: any) {\n      console.error(`[research] ${queryProgress} âœ— UNEXPECTED ERROR processing query \"${queryItem.query}\":`, {\n        error: error.message,\n        stack: error.stack,\n        type: error.constructor?.name || 'Unknown',\n      });\n      // Continue with other queries\n      await updateGenerationCycle(supabase, generationCycleId, {\n        progress_current: queryNumber,\n      });\n    }\n  }\n\n  // Poll for pending research tasks if any were started\n  if (pendingResearchTasks.length > 0 && exa) {\n    console.log(`[research] ========================================`);\n    console.log(`[research] Starting background polling for ${pendingResearchTasks.length} research task(s)...`);\n    console.log(`[research] ========================================`);\n    \n    await pollResearchTasks(\n      exa,\n      pendingResearchTasks,\n      supabase,\n      eventId,\n      blueprintId,\n      generationCycleId,\n      chunks,\n      insertedCount,\n      costBreakdown\n    );\n  }\n\n  // Calculate total cost\n  const totalCost = costBreakdown.openai.total + costBreakdown.exa.total;\n  \n  console.log(`[research] ========================================`);\n  console.log(`[research] Research plan execution COMPLETE`);\n  console.log(`[research] Total cost: $${totalCost.toFixed(4)} (OpenAI: $${costBreakdown.openai.total.toFixed(4)}, Exa: $${costBreakdown.exa.total.toFixed(4)})`);\n  \n  // Store cost data in generation cycle metadata\n  const costMetadata = {\n    cost: {\n      total: totalCost,\n      currency: 'USD',\n      breakdown: {\n        openai: {\n          total: costBreakdown.openai.total,\n          chat_completions: costBreakdown.openai.chat_completions,\n        },\n        exa: {\n          total: costBreakdown.exa.total,\n          search: costBreakdown.exa.search,\n          research: costBreakdown.exa.research,\n          answer: costBreakdown.exa.answer,\n        },\n      },\n      tracked_at: new Date().toISOString(),\n      pricing_version: getPricingVersion(),\n    },\n  };\n\n  // Mark cycle as completed with cost metadata\n  await updateGenerationCycle(supabase, generationCycleId, {\n    status: 'completed',\n    progress_current: queries.length,\n    metadata: costMetadata,\n  });\n\n  console.log(`[research] ========================================`);\n  console.log(`[research] Total queries processed: ${queries.length}`);\n  console.log(`[research] Total chunks created: ${insertedCount.value}`);\n  console.log(`[research] Results stored in database: ${insertedCount.value}`);\n  console.log(`[research] ========================================`);\n  \n  return { chunks };\n}\n\n/**\n * Generate stub research chunks (fallback when Exa API not available)\n */\nasync function generateStubResearchChunks(\n  query: string,\n  openai: OpenAI,\n  genModel: string,\n  costBreakdown?: { openai: { total: number; chat_completions: Array<{ cost: number; usage: any; model: string }> } }\n): Promise<string[]> {\n  try {\n    // Some models (like o1, o1-preview, o1-mini, gpt-5) don't support custom temperature values\n    const modelLower = genModel.toLowerCase();\n    const isO1Model = modelLower.startsWith('o1');\n    const isGpt5Model = modelLower.includes('gpt-5') || modelLower.startsWith('gpt5');\n    const onlySupportsDefaultTemp = isO1Model || isGpt5Model;\n    const supportsCustomTemperature = !onlySupportsDefaultTemp;\n\n    const requestOptions: any = {\n      model: genModel,\n      messages: [\n        {\n          role: 'system',\n          content: STUB_RESEARCH_SYSTEM_PROMPT,\n        },\n        {\n          role: 'user',\n          content: createStubResearchUserPrompt(query),\n        },\n      ],\n      response_format: { type: 'json_object' },\n    };\n\n    if (supportsCustomTemperature) {\n      requestOptions.temperature = 0.7;\n    }\n\n    const response = await openai.chat.completions.create(requestOptions);\n\n    // Track cost\n    if (costBreakdown && response.usage) {\n      const usage = response.usage;\n      const cost = calculateOpenAICost(usage, genModel, false);\n      costBreakdown.openai.total += cost;\n      costBreakdown.openai.chat_completions.push({\n        cost,\n        usage: {\n          prompt_tokens: usage.prompt_tokens,\n          completion_tokens: usage.completion_tokens,\n          total_tokens: usage.total_tokens,\n        },\n        model: genModel,\n      });\n    }\n\n    const content = response.choices[0]?.message?.content;\n    if (!content) {\n      return [];\n    }\n\n    const parsed = JSON.parse(content);\n    return parsed.chunks || [];\n  } catch (error: any) {\n    console.error(`[research] Error generating stub chunks: ${error.message}`);\n    return [];\n  }\n}\n\n/**\n * Chunk text content into smaller pieces (200-400 words each)\n * Attempts to split on sentence boundaries\n */\nfunction chunkTextContent(text: string, minWords: number, maxWords: number): string[] {\n  const words = text.split(/\\s+/);\n  const chunks: string[] = [];\n  \n  let currentChunk: string[] = [];\n  let currentWordCount = 0;\n\n  for (const word of words) {\n    currentChunk.push(word);\n    currentWordCount++;\n\n    // Check if we should finalize this chunk\n    if (currentWordCount >= minWords) {\n      // Try to end on sentence boundary if we're past min words\n      if (currentWordCount >= maxWords || word.match(/[.!?]$/)) {\n        chunks.push(currentChunk.join(' '));\n        currentChunk = [];\n        currentWordCount = 0;\n      }\n    }\n  }\n\n  // Add remaining chunk if any\n  if (currentChunk.length > 0) {\n    chunks.push(currentChunk.join(' '));\n  }\n\n  return chunks.length > 0 ? chunks : [text]; // Fallback to original text if chunking fails\n}\n\n/**\n * Execute Exa search and store results\n * Extracted as helper function for reuse\n */\nasync function executeExaSearch(\n  queryItem: { query: string },\n  exa: Exa,\n  supabase: ReturnType<typeof createClient>,\n  eventId: string,\n  blueprintId: string,\n  generationCycleId: string,\n  chunks: ResearchResults['chunks'],\n  insertedCount: { value: number },\n  costBreakdown?: { exa: { total: number; search: { cost: number; queries: number } } }\n): Promise<void> {\n  const startTime = Date.now();\n  \n  try {\n    console.log(`[research] Exa /search: Initiating search for \"${queryItem.query}\"...`);\n    \n    // Track cost\n    if (costBreakdown) {\n      const searchCost = calculateExaSearchCost(1);\n      costBreakdown.exa.total += searchCost;\n      costBreakdown.exa.search.cost += searchCost;\n      costBreakdown.exa.search.queries += 1;\n    }\n    \n    // Search and get contents from Exa\n    // Using search() with contents option (searchAndContents is deprecated)\n    const searchResults = await exa.search(queryItem.query, {\n      contents: { text: true },\n      numResults: 5, // Get top 5 results per query\n    });\n\n    const searchDuration = Date.now() - startTime;\n    \n    if (!searchResults.results || searchResults.results.length === 0) {\n      console.warn(`[research] Exa /search: No results found for query \"${queryItem.query}\" (duration: ${searchDuration}ms)`);\n      return;\n    }\n    \n    console.log(`[research] Exa /search: Received ${searchResults.results.length} results in ${searchDuration}ms for query: \"${queryItem.query}\"`);\n\n    // Process each result and create chunks\n    let processedResults = 0;\n    let skippedResults = 0;\n    \n    for (const result of searchResults.results) {\n      if (!result.text) {\n        console.warn(`[research] Exa /search: Result missing text content for URL: ${result.url}`);\n        skippedResults++;\n        continue;\n      }\n      \n      processedResults++;\n\n      // Split long text into chunks (200-400 words each)\n      const textChunks = chunkTextContent(result.text, 200, 400);\n      \n      for (const chunkText of textChunks) {\n        const metadata = {\n          api: 'exa',\n          query: queryItem.query,\n          url: result.url,\n          title: result.title || null,\n          author: result.author || null,\n          published_date: result.publishedDate || null,\n          quality_score: calculateQualityScore(result, chunkText),\n        };\n\n        const { error } = await (supabase\n          .from('research_results') as any)\n          .insert({\n            event_id: eventId,\n            blueprint_id: blueprintId,\n            generation_cycle_id: generationCycleId,\n            query: queryItem.query,\n            api: 'exa',\n            content: chunkText,\n            source_url: result.url,\n            quality_score: metadata.quality_score,\n            metadata: metadata,\n          });\n\n        if (error) {\n          console.error(`[research] Exa /search: Database error storing result for \"${queryItem.query}\": ${error.message}`);\n        } else {\n          insertedCount.value++;\n          chunks.push({\n            text: chunkText,\n            source: 'exa',\n            metadata,\n          });\n        }\n      }\n    }\n    \n    const totalDuration = Date.now() - startTime;\n    console.log(`[research] Exa /search: Processed ${processedResults}/${searchResults.results.length} results (${skippedResults} skipped), created ${insertedCount.value} chunks in ${totalDuration}ms for query: \"${queryItem.query}\"`);\n  } catch (exaError: any) {\n    const duration = Date.now() - startTime;\n    console.error(`[research] âœ— Exa /search API FAILURE for query \"${queryItem.query}\":`, {\n      error: exaError.message,\n      stack: exaError.stack,\n      duration: `${duration}ms`,\n      statusCode: exaError.status || exaError.statusCode || 'N/A',\n      code: exaError.code || 'N/A',\n      response: exaError.response ? JSON.stringify(exaError.response).substring(0, 300) : 'N/A',\n      type: exaError.constructor?.name || 'Unknown',\n    });\n    throw exaError; // Re-throw to allow caller to handle\n  }\n}\n\n/**\n * Execute Wikipedia search and store results\n * Uses Wikipedia MediaWiki API (free, no API key required)\n */\nasync function executeWikipediaSearch(\n  query: string,\n  supabase: ReturnType<typeof createClient>,\n  eventId: string,\n  blueprintId: string,\n  generationCycleId: string\n): Promise<ResearchResults['chunks']> {\n  const chunks: ResearchResults['chunks'] = [];\n  const startTime = Date.now();\n  \n  try {\n    // Step 1: Search Wikipedia for relevant articles\n    console.log(`[research] Wikipedia: Searching for articles matching \"${query}\"...`);\n    const searchUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&srlimit=5&format=json&origin=*`;\n    \n    const searchResponse = await fetch(searchUrl);\n    if (!searchResponse.ok) {\n      const errorText = await searchResponse.text().catch(() => 'Unable to read response');\n      throw new Error(`Wikipedia search API returned ${searchResponse.status}: ${errorText.substring(0, 200)}`);\n    }\n    \n    const searchData = await searchResponse.json() as {\n      query?: {\n        search?: Array<{\n          title: string;\n          pageid: number;\n          snippet: string;\n        }>;\n      };\n    };\n    const searchResults = searchData.query?.search || [];\n    const searchDuration = Date.now() - startTime;\n    \n    if (searchResults.length === 0) {\n      console.warn(`[research] Wikipedia: No articles found for query \"${query}\" (duration: ${searchDuration}ms)`);\n      return chunks;\n    }\n    \n    console.log(`[research] Wikipedia: Found ${searchResults.length} articles in ${searchDuration}ms for query: \"${query}\"`);\n    \n    // Step 2: Fetch content for top results\n    let processedArticles = 0;\n    let skippedArticles = 0;\n    \n    for (const result of searchResults) {\n      const articleStartTime = Date.now();\n      try {\n        // Use Wikipedia REST API for page summaries (simpler and faster)\n        const pageTitle = encodeURIComponent(result.title.replace(/ /g, '_'));\n        const summaryUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${pageTitle}`;\n        \n        const summaryResponse = await fetch(summaryUrl);\n        \n        if (!summaryResponse.ok) {\n          const errorText = await summaryResponse.text().catch(() => 'Unable to read response');\n          console.warn(`[research] Wikipedia: Failed to fetch summary for \"${result.title}\" (status: ${summaryResponse.status}): ${errorText.substring(0, 100)}`);\n          skippedArticles++;\n          continue;\n        }\n        \n        const summaryData = await summaryResponse.json() as {\n          extract?: string;\n          extract_html?: string;\n          title?: string;\n          content_urls?: {\n            desktop?: {\n              page?: string;\n            };\n          };\n          thumbnail?: {\n            source?: string;\n          };\n          coordinates?: {\n            lat?: number;\n            lon?: number;\n          };\n        };\n        \n        // Combine extract and extract_html for better content\n        let content = summaryData.extract || '';\n        if (summaryData.extract_html) {\n          // Strip HTML tags for plain text\n          content = summaryData.extract_html.replace(/<[^>]*>/g, ' ').replace(/\\s+/g, ' ').trim();\n        }\n        \n        if (!content || content.length < 50) {\n          console.warn(`[research] Wikipedia: Article \"${result.title}\" has insufficient content (${content?.length || 0} chars)`);\n          skippedArticles++;\n          continue;\n        }\n        \n        const articleDuration = Date.now() - articleStartTime;\n        processedArticles++;\n        \n        // Split content into chunks (200-400 words each)\n        const textChunks = chunkTextContent(content, 200, 400);\n        \n        for (const chunkText of textChunks) {\n          const metadata = {\n            api: 'wikipedia',\n            query: query,\n            title: result.title,\n            url: summaryData.content_urls?.desktop?.page || `https://en.wikipedia.org/wiki/${pageTitle}`,\n            page_id: result.pageid,\n            quality_score: calculateWikipediaQualityScore(summaryData, chunkText),\n          };\n          \n          const { error } = await (supabase\n            .from('research_results') as any)\n            .insert({\n              event_id: eventId,\n              blueprint_id: blueprintId,\n              generation_cycle_id: generationCycleId,\n              query: query,\n              api: 'wikipedia',\n              content: chunkText,\n              source_url: metadata.url,\n              quality_score: metadata.quality_score,\n              metadata: metadata,\n            });\n          \n          if (error) {\n            console.error(`[research] Wikipedia: Database error storing result for article \"${result.title}\": ${error.message}`);\n          } else {\n            chunks.push({\n              text: chunkText,\n              source: 'wikipedia',\n              metadata,\n            });\n          }\n        }\n        \n        console.log(`[research] Wikipedia: Processed article \"${result.title}\" - ${textChunks.length} chunks created in ${articleDuration}ms`);\n      } catch (articleError: any) {\n        const articleDuration = Date.now() - articleStartTime;\n        console.warn(`[research] Wikipedia: Error processing article \"${result.title}\" (duration: ${articleDuration}ms):`, {\n          error: articleError.message,\n          stack: articleError.stack,\n          statusCode: articleError.status || articleError.statusCode || 'N/A',\n        });\n        skippedArticles++;\n      }\n    }\n    \n    const totalDuration = Date.now() - startTime;\n    console.log(`[research] Wikipedia: Completed query \"${query}\" - ${processedArticles}/${searchResults.length} articles processed (${skippedArticles} skipped), ${chunks.length} chunks created in ${totalDuration}ms`);\n\n    return chunks;\n  } catch (error: any) {\n    const duration = Date.now() - startTime;\n    console.error(`[research] âœ— Wikipedia API FAILURE for query \"${query}\":`, {\n      error: error.message,\n      stack: error.stack,\n      duration: `${duration}ms`,\n      statusCode: error.status || error.statusCode || 'N/A',\n      type: error.constructor?.name || 'Unknown',\n    });\n    throw error;\n  }\n}\n\n/**\n * Calculate quality score for Wikipedia content\n */\nfunction calculateWikipediaQualityScore(articleData: any, chunkText: string): number {\n  let score = 0.6; // Base score (Wikipedia is generally reliable)\n  \n  // Boost for substantial content\n  const wordCount = chunkText.split(/\\s+/).length;\n  if (wordCount > 100) {\n    score += 0.1;\n  }\n  \n  // Boost if article has thumbnail (often indicates well-maintained article)\n  if (articleData.thumbnail) {\n    score += 0.1;\n  }\n  \n  // Boost if article has coordinates (often indicates factual accuracy)\n  if (articleData.coordinates) {\n    score += 0.1;\n  }\n  \n  // Boost for longer extract (more comprehensive)\n  if (articleData.extract && articleData.extract.length > 500) {\n    score += 0.1;\n  }\n  \n  // Cap at 1.0\n  return Math.min(score, 1.0);\n}\n\n/**\n * Calculate quality score for a research result chunk\n * Based on source metadata and content characteristics\n */\nfunction calculateQualityScore(result: any, chunkText: string): number {\n  let score = 0.5; // Base score\n\n  // Boost for having a title\n  if (result.title && result.title.length > 10) {\n    score += 0.1;\n  }\n\n  // Boost for having author\n  if (result.author) {\n    score += 0.1;\n  }\n\n  // Boost for recent publication date\n  if (result.publishedDate) {\n    try {\n      const published = new Date(result.publishedDate);\n      const now = new Date();\n      const daysSincePublished = (now.getTime() - published.getTime()) / (1000 * 60 * 60 * 24);\n      \n      // Recent content (within 2 years) gets higher score\n      if (daysSincePublished < 730) {\n        score += 0.1;\n      }\n    } catch (e) {\n      // Ignore date parsing errors\n    }\n  }\n\n  // Boost for substantial content (more than 100 words)\n  const wordCount = chunkText.split(/\\s+/).length;\n  if (wordCount > 100) {\n    score += 0.1;\n  }\n\n  // Cap at 1.0\n  return Math.min(score, 1.0);\n}\n\n/**\n * Update agent status\n */\nasync function updateAgentStatus(\n  supabase: ReturnType<typeof createClient>,\n  agentId: string,\n  stage: string\n): Promise<void> {\n  // Map stage to status: context generation stages use 'idle' status\n  // 'running' stage uses 'active' status\n  const status = stage === 'running' ? 'active' : 'idle';\n  \n  const { error } = await (supabase\n    .from('agents') as any)\n    .update({ status, stage })\n    .eq('id', agentId);\n\n  if (error) {\n    throw new Error(`Failed to update agent status: ${error.message}`);\n  }\n}\n\n/**\n * Update blueprint status\n */\nasync function updateBlueprintStatus(\n  supabase: ReturnType<typeof createClient>,\n  blueprintId: string,\n  status: string,\n  errorMessage?: string\n): Promise<void> {\n  // Only allow: 'generating', 'approved', 'error'\n  // 'executing' and 'completed' removed - tracked via agent status and generation_cycles\n  const allowedStatuses = ['generating', 'approved', 'error'];\n  if (!allowedStatuses.includes(status)) {\n    console.warn(`[context-gen] Warning: Blueprint status '${status}' not allowed, skipping update`);\n    return;\n  }\n\n  const update: any = { status };\n  if (errorMessage) {\n    update.error_message = errorMessage;\n  }\n\n  const { error } = await (supabase\n    .from('context_blueprints') as any)\n    .update(update)\n    .eq('id', blueprintId);\n\n  if (error) {\n    console.warn(`[context-gen] Warning: Failed to update blueprint status: ${error.message}`);\n    // Don't throw - status update is not critical\n  }\n}\n\n/**\n * Regenerate research stage only\n * Requires: Approved blueprint\n */\nexport async function regenerateResearchStage(\n  eventId: string,\n  agentId: string,\n  blueprintId: string,\n  options: ContextGenerationOrchestratorOptions\n): Promise<ResearchResults> {\n  const { supabase, openai, genModel } = options;\n\n  console.log(`[context-gen] Regenerating research stage for event ${eventId}, agent ${agentId}, blueprint ${blueprintId}`);\n\n  // Fetch blueprint\n  const { data: blueprintRecord, error: blueprintError } = await (supabase\n    .from('context_blueprints') as any)\n    .select('*')\n    .eq('id', blueprintId)\n    .single() as { data: any | null; error: any };\n\n  if (blueprintError || !blueprintRecord) {\n    throw new Error(`Failed to fetch blueprint: ${blueprintError?.message || 'Blueprint not found'}`);\n  }\n\n  const blueprint = blueprintRecord.blueprint as Blueprint;\n\n  if (blueprintRecord.status !== 'approved') {\n    throw new Error(`Blueprint must be approved to regenerate research. Current status: ${blueprintRecord.status}`);\n  }\n\n  // Create generation cycle first (we'll use it to filter what to delete)\n  const researchCycleId = await createGenerationCycle(\n    supabase,\n    eventId,\n    agentId,\n    blueprintId,\n    'research',\n    'research'\n  );\n\n  // Update status\n  await updateAgentStatus(supabase, agentId, 'researching');\n  // Blueprint status stays 'approved'\n\n  // Execute research and store in research_results\n  const researchResults = await executeResearchPlan(\n    eventId,\n    blueprintId,\n    blueprint,\n    researchCycleId,\n    { supabase, openai, genModel, exaApiKey: options.exaApiKey }\n  );\n\n  console.log(`[context-gen] Research regeneration completed: ${researchResults.chunks.length} chunks found`);\n\n  // Mark old research generation cycles as superseded (don't delete data, just mark cycles)\n  const { error: researchCycleError } = await (supabase\n    .from('generation_cycles') as any)\n    .update({\n      status: 'superseded',\n    })\n    .eq('event_id', eventId)\n    .eq('cycle_type', 'research')\n    .neq('id', researchCycleId)\n    .in('status', ['started', 'processing', 'completed']);\n\n  if (researchCycleError) {\n    console.warn(`[context-gen] Warning: Failed to mark old research cycles as superseded: ${researchCycleError.message}`);\n  }\n\n  // Mark downstream components (glossary, chunks) cycles as superseded\n  // Don't delete data - only mark cycles to prevent UI visualization and downstream access\n  const { error: downstreamCycleError } = await (supabase\n    .from('generation_cycles') as any)\n    .update({\n      status: 'superseded',\n    })\n    .eq('event_id', eventId)\n    .in('cycle_type', ['glossary', 'chunks'])\n    .in('status', ['started', 'processing', 'completed']);\n\n  if (downstreamCycleError) {\n    console.warn(`[context-gen] Warning: Failed to mark downstream cycles as superseded: ${downstreamCycleError.message}`);\n  }\n\n  console.log(`[context-gen] Downstream components (glossary, chunks) marked for regeneration`);\n\n  // Automatically regenerate downstream components since research changed\n  console.log(`[context-gen] Auto-regenerating downstream components after research regeneration`);\n  \n  try {\n    // Regenerate glossary\n    const glossaryCycleId = await createGenerationCycle(\n      supabase,\n      eventId,\n      agentId,\n      blueprintId,\n      'glossary',\n      'glossary'\n    );\n\n    await updateAgentStatus(supabase, agentId, 'building_glossary');\n    const glossaryCount = await buildGlossary(\n      eventId,\n      blueprintId,\n      glossaryCycleId,\n      blueprint,\n      null, // Fetch from research_results table\n      {\n        supabase,\n        openai,\n        genModel,\n        embedModel: options.embedModel,\n        exaApiKey: options.exaApiKey,\n      }\n    );\n    console.log(`[context-gen] Glossary auto-regenerated: ${glossaryCount} terms`);\n\n    // Regenerate chunks\n    const chunksCycleId = await createGenerationCycle(\n      supabase,\n      eventId,\n      agentId,\n      blueprintId,\n      'chunks',\n      'llm_chunks'\n    );\n\n    await updateAgentStatus(supabase, agentId, 'building_chunks');\n    const chunksResult = await buildContextChunks(\n      eventId,\n      blueprintId,\n      chunksCycleId,\n      blueprint,\n      null, // Fetch from research_results table\n      {\n        supabase,\n        openai,\n        embedModel: options.embedModel,\n        genModel,\n      }\n    );\n    console.log(`[context-gen] Chunks auto-regenerated: ${chunksResult.chunkCount} chunks (cost: $${chunksResult.costBreakdown.openai.total.toFixed(4)})`);\n\n    // Mark as complete\n    await updateAgentStatus(supabase, agentId, 'context_complete');\n    console.log(`[context-gen] All downstream components regenerated successfully`);\n  } catch (downstreamError: any) {\n    console.error(`[context-gen] Error auto-regenerating downstream components: ${downstreamError.message}`);\n    // Don't throw - research regeneration was successful, downstream can be regenerated manually\n    await updateAgentStatus(supabase, agentId, 'researching');\n  }\n\n  return researchResults;\n}\n\n/**\n * Regenerate glossary stage only\n * Requires: Approved blueprint, research results\n */\nexport async function regenerateGlossaryStage(\n  eventId: string,\n  agentId: string,\n  blueprintId: string,\n  options: ContextGenerationOrchestratorOptions,\n  researchResults?: ResearchResults\n): Promise<number> {\n  const { supabase, openai, genModel, embedModel } = options;\n\n  console.log(`[context-gen] Regenerating glossary stage for event ${eventId}, agent ${agentId}, blueprint ${blueprintId}`);\n\n  // Fetch blueprint\n  const { data: blueprintRecord, error: blueprintError } = await (supabase\n    .from('context_blueprints') as any)\n    .select('*')\n    .eq('id', blueprintId)\n    .single() as { data: any | null; error: any };\n\n  if (blueprintError || !blueprintRecord) {\n    throw new Error(`Failed to fetch blueprint: ${blueprintError?.message || 'Blueprint not found'}`);\n  }\n\n  const blueprint = blueprintRecord.blueprint as Blueprint;\n\n  if (blueprintRecord.status !== 'approved') {\n    throw new Error(`Blueprint must be approved to regenerate glossary. Current status: ${blueprintRecord.status}`);\n  }\n\n  // Create generation cycle\n  const glossaryCycleId = await createGenerationCycle(\n    supabase,\n    eventId,\n    agentId,\n    blueprintId,\n    'glossary',\n    'glossary'\n  );\n\n  // Update status\n  await updateAgentStatus(supabase, agentId, 'building_glossary');\n\n  // Build glossary (fetches research from research_results table)\n  const glossaryCount = await buildGlossary(\n    eventId,\n    blueprintId,\n    glossaryCycleId,\n    blueprint,\n    null, // Fetch from research_results table\n    {\n      supabase,\n      openai,\n      genModel,\n      embedModel,\n      exaApiKey: options.exaApiKey,\n    }\n  );\n\n  console.log(`[context-gen] Glossary regeneration completed: ${glossaryCount.termCount} terms`);\n\n  // Mark old glossary generation cycles as superseded (don't delete data, just mark cycles)\n  // Note: Glossary and chunks are independent - regenerating glossary does not invalidate chunks\n  const { error: glossaryCycleError } = await (supabase\n    .from('generation_cycles') as any)\n    .update({\n      status: 'superseded',\n    })\n    .eq('event_id', eventId)\n    .eq('cycle_type', 'glossary')\n    .neq('id', glossaryCycleId)\n    .in('status', ['started', 'processing', 'completed']);\n\n  if (glossaryCycleError) {\n    console.warn(`[context-gen] Warning: Failed to mark old glossary cycles as superseded: ${glossaryCycleError.message}`);\n  }\n\n  // Update agent to context_complete\n  await updateAgentStatus(supabase, agentId, 'context_complete');\n\n  return glossaryCount.termCount;\n}\n\n/**\n * Regenerate chunks stage only\n * Requires: Approved blueprint, research results\n */\nexport async function regenerateChunksStage(\n  eventId: string,\n  agentId: string,\n  blueprintId: string,\n  options: ContextGenerationOrchestratorOptions,\n  researchResults?: ResearchResults\n): Promise<number> {\n  const { supabase, openai, embedModel, genModel } = options;\n\n  console.log(`[context-gen] Regenerating chunks stage for event ${eventId}, agent ${agentId}, blueprint ${blueprintId}`);\n\n  // Fetch blueprint\n  const { data: blueprintRecord, error: blueprintError } = await (supabase\n    .from('context_blueprints') as any)\n    .select('*')\n    .eq('id', blueprintId)\n    .single() as { data: any | null; error: any };\n\n  if (blueprintError || !blueprintRecord) {\n    throw new Error(`Failed to fetch blueprint: ${blueprintError?.message || 'Blueprint not found'}`);\n  }\n\n  const blueprint = blueprintRecord.blueprint as Blueprint;\n\n  if (blueprintRecord.status !== 'approved') {\n    throw new Error(`Blueprint must be approved to regenerate chunks. Current status: ${blueprintRecord.status}`);\n  }\n\n  // Create generation cycle\n  const chunksCycleId = await createGenerationCycle(\n    supabase,\n    eventId,\n    agentId,\n    blueprintId,\n    'chunks',\n    'llm_chunks'\n  );\n\n  // Update status\n  await updateAgentStatus(supabase, agentId, 'building_chunks');\n\n  // Build chunks (fetches research from research_results table, preserves research chunks)\n  const chunksResult = await buildContextChunks(\n    eventId,\n    blueprintId,\n    chunksCycleId,\n    blueprint,\n    null, // Fetch from research_results table\n    {\n      supabase,\n      openai,\n      embedModel,\n      genModel,\n    }\n  );\n\n  console.log(`[context-gen] Chunks regeneration completed: ${chunksResult.chunkCount} chunks (cost: $${chunksResult.costBreakdown.openai.total.toFixed(4)})`);\n\n  // Mark old chunks generation cycles as superseded (don't delete data, just mark cycles)\n  const { error: chunksCycleError } = await (supabase\n    .from('generation_cycles') as any)\n    .update({\n      status: 'superseded',\n    })\n    .eq('event_id', eventId)\n    .eq('cycle_type', 'chunks')\n    .neq('id', chunksCycleId)\n    .in('status', ['started', 'processing', 'completed']);\n\n  if (chunksCycleError) {\n    console.warn(`[context-gen] Warning: Failed to mark old chunks cycles as superseded: ${chunksCycleError.message}`);\n  }\n\n  // Update to context_complete\n  await updateAgentStatus(supabase, agentId, 'context_complete');\n  // Blueprint status stays 'approved'\n\n  return chunksResult.chunkCount;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/will-liao/Desktop/Coding/Git/jarvis/worker/context/pipeline/glossary-builder.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ErrorWithResponse' is defined but never used.","line":85,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Glossary Builder\n * Builds glossary from blueprint plan and research results\n * Stores terms, definitions, acronyms, and related metadata in glossary_terms table\n */\n\nimport type { createClient } from '@supabase/supabase-js';\nimport type OpenAI from 'openai';\nimport { Exa } from 'exa-js';\nimport type { Blueprint } from './blueprint-generator';\nimport {\n  calculateOpenAICost,\n  calculateExaAnswerCost,\n  getPricingVersion,\n  type OpenAIUsage,\n} from './pricing-config';\nimport {\n  EXA_ANSWER_SYSTEM_PROMPT,\n  GLOSSARY_DEFINITION_SYSTEM_PROMPT,\n  createGlossaryDefinitionUserPrompt,\n  EXA_ANSWER_TRANSFORM_SYSTEM_PROMPT,\n  createExaAnswerTransformUserPrompt,\n} from '../../prompts';\n\nexport interface GlossaryBuilderOptions {\n  supabase: ReturnType<typeof createClient>;\n  openai: OpenAI;\n  genModel: string;\n  embedModel: string;\n  exaApiKey?: string; // Optional Exa API key for authoritative definitions\n}\n\nexport type ResearchChunkMetadata = {\n  api?: string;\n  quality_score?: number;\n} & Record<string, unknown>;\n\nexport interface ResearchResults {\n  chunks: Array<{\n    text: string;\n    source: string;\n    metadata?: ResearchChunkMetadata;\n  }>;\n}\ntype ResearchChunk = ResearchResults['chunks'][number];\n\n/**\n * Build glossary from blueprint plan and research results\n * Fetches research from research_results table if not provided\n */\nexport interface GlossaryCostBreakdown {\n  openai: {\n    total: number;\n    chat_completions: Array<{ cost: number; usage: OpenAIUsage; model: string }>;\n  };\n  exa: {\n    total: number;\n    answer: { cost: number; queries: number };\n  };\n}\n\nexport interface GlossaryBuildResult {\n  termCount: number;\n  costBreakdown: GlossaryCostBreakdown;\n}\n\ntype SupabaseErrorLike = { message: string } | null;\ntype SupabaseMutationResult = { error: SupabaseErrorLike };\ntype SupabaseListResult<T> = { data: T[] | null; error: SupabaseErrorLike };\ntype IdRow = { id: string };\ntype ResearchResultRecord = {\n  content: string;\n  metadata: ResearchChunkMetadata | null;\n  query: string | null;\n  api: string | null;\n};\ntype ChatCompletionRequest = Parameters<OpenAI['chat']['completions']['create']>[0];\ntype GlossaryPlanTerm = {\n  term: string;\n  is_acronym: boolean;\n  category: string;\n  priority: number;\n};\nconst asDbPayload = <T>(payload: T) => payload as unknown as never;\ntype ErrorWithResponse = Error & { response?: { data?: unknown } };\n\nexport async function buildGlossary(\n  eventId: string,\n  blueprintId: string,\n  generationCycleId: string,\n  blueprint: Blueprint,\n  researchResults: ResearchResults | null,\n  options: GlossaryBuilderOptions\n): Promise<GlossaryBuildResult> {\n  const { supabase, openai, genModel, exaApiKey } = options;\n\n  console.log(`[glossary] Building glossary for event ${eventId}, cycle ${generationCycleId}`);\n  console.log(`[glossary] Blueprint has ${blueprint.glossary_plan.terms.length} terms planned`);\n\n  const termsToBuild = blueprint.glossary_plan.terms || [];\n  if (termsToBuild.length === 0) {\n    console.log(`[glossary] No terms to build, skipping`);\n    return {\n      termCount: 0,\n      costBreakdown: {\n        openai: { total: 0, chat_completions: [] },\n        exa: { total: 0, answer: { cost: 0, queries: 0 } },\n      },\n    };\n  }\n\n  // Initialize cost tracking\n  const costBreakdown: GlossaryCostBreakdown = {\n    openai: {\n      total: 0,\n      chat_completions: [],\n    },\n    exa: {\n      total: 0,\n      answer: { cost: 0, queries: 0 },\n    },\n  };\n\n  // Fetch research from research_results table if not provided\n  // Exclude research from superseded generation cycles\n  let research: ResearchResults;\n  if (!researchResults) {\n    // First, get all active (non-superseded) generation cycle IDs for research\n    const {\n      data: activeCycles,\n      error: cycleError,\n    }: SupabaseListResult<IdRow> = await supabase\n      .from('generation_cycles')\n      .select('id')\n      .eq('event_id', eventId)\n      .neq('status', 'superseded')\n      .in('cycle_type', ['research']);\n\n    if (cycleError) {\n      console.warn(`[glossary] Warning: Failed to fetch active research cycles: ${cycleError.message}`);\n    }\n\n    // Build list of active cycle IDs\n    const activeCycleIds: string[] = [];\n    if (activeCycles && activeCycles.length > 0) {\n      activeCycleIds.push(...activeCycles.map((cycle: IdRow) => cycle.id));\n    }\n\n    // Fetch research results only from active cycles (or legacy items)\n    let researchQuery = supabase\n      .from('research_results')\n      .select('content, metadata, query, api')\n      .eq('event_id', eventId)\n      .eq('blueprint_id', blueprintId);\n\n    if (activeCycleIds.length > 0) {\n      // Include items with null generation_cycle_id OR items from active cycles\n      researchQuery = researchQuery.or(`generation_cycle_id.is.null,generation_cycle_id.in.(${activeCycleIds.join(',')})`);\n    } else {\n      // If no active cycles, only show legacy items (null generation_cycle_id)\n      researchQuery = researchQuery.is('generation_cycle_id', null);\n    }\n\n    const {\n      data: researchData,\n      error: researchError,\n    }: SupabaseListResult<ResearchResultRecord> = await researchQuery;\n\n    if (researchError) {\n      console.warn(`[glossary] Warning: Failed to fetch research results: ${researchError.message}`);\n    }\n\n    research = {\n      chunks: (researchData ?? []).map((item: ResearchResultRecord) => ({\n        text: item.content,\n        source: item.api || 'research',\n        metadata: item.metadata || undefined,\n      })),\n    };\n  } else {\n    research = researchResults;\n  }\n\n  // Legacy deletion code removed - we now use superseding approach\n  // Old glossary terms are marked as superseded via generation cycles, not deleted\n\n  // Extract context from research results\n  const researchContext = research.chunks\n    .map((chunk: ResearchChunk) => chunk.text)\n    .join('\\n\\n')\n    .substring(0, 10000); // Limit context size\n\n  let insertedCount = 0;\n\n  // Update generation cycle progress\n  const { error: processingError }: SupabaseMutationResult = await supabase\n    .from('generation_cycles')\n    .update(asDbPayload({\n      status: 'processing',\n      progress_total: termsToBuild.length,\n    }))\n    .eq('id', generationCycleId);\n\n  if (processingError) {\n    console.warn(`[glossary] Failed to mark cycle ${generationCycleId} as processing: ${processingError.message}`);\n  }\n\n  // Process terms in batches to avoid rate limits\n  const batchSize = 5;\n  for (let i = 0; i < termsToBuild.length; i += batchSize) {\n    const batch = termsToBuild.slice(i, i + batchSize);\n    \n    try {\n      const { definitions } = await generateTermDefinitions(\n        batch,\n        researchContext,\n        blueprint.important_details.join('\\n'),\n        openai,\n        genModel,\n        exaApiKey ? new Exa(exaApiKey) : undefined,\n        costBreakdown\n      );\n\n      // Store definitions in database\n      for (const def of definitions) {\n        try {\n          const { error: insertError }: SupabaseMutationResult = await supabase\n            .from('glossary_terms')\n            .insert(asDbPayload({\n              event_id: eventId,\n              generation_cycle_id: generationCycleId,\n              term: def.term,\n              definition: def.definition,\n              acronym_for: def.acronym_for || null,\n              category: def.category || 'general',\n              usage_examples: def.usage_examples || [],\n              related_terms: def.related_terms || [],\n              confidence_score: def.confidence_score || 0.8,\n              source: def.source || 'llm_generation',\n              source_url: def.source_url || null,\n            }));\n\n          if (insertError) {\n            console.error(`[glossary] Error inserting term \"${def.term}\": ${insertError.message}`);\n          } else {\n            insertedCount++;\n            // Update progress\n            const { error: progressError }: SupabaseMutationResult = await supabase\n              .from('generation_cycles')\n              .update(asDbPayload({ progress_current: insertedCount }))\n              .eq('id', generationCycleId);\n\n            if (progressError) {\n              console.warn(`[glossary] Failed to update cycle progress for ${generationCycleId}: ${progressError.message}`);\n            }\n          }\n        // TODO: narrow unknown -> PostgrestError after upstream callsite analysis\n        } catch (error: unknown) {\n          const message = error instanceof Error ? error.message : String(error);\n          console.error(`[glossary] Error processing term \"${def.term}\": ${message}`);\n        }\n      }\n    // TODO: narrow unknown -> OpenAIAPIError after upstream callsite analysis\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : String(error);\n      console.error(`[glossary] Error processing batch: ${message}`);\n    }\n  }\n\n  // Calculate total cost and store in cycle metadata\n  const totalCost = costBreakdown.openai.total + costBreakdown.exa.total;\n  const costMetadata = {\n    cost: {\n      total: totalCost,\n      currency: 'USD',\n      breakdown: {\n        openai: {\n          total: costBreakdown.openai.total,\n          chat_completions: costBreakdown.openai.chat_completions,\n        },\n        exa: {\n          total: costBreakdown.exa.total,\n          answer: costBreakdown.exa.answer,\n        },\n      },\n      tracked_at: new Date().toISOString(),\n      pricing_version: getPricingVersion(),\n    },\n  };\n\n  // Mark cycle as completed with cost metadata\n  const { error: cycleUpdateError }: SupabaseMutationResult = await supabase\n    .from('generation_cycles')\n    .update(asDbPayload({\n      status: 'completed',\n      progress_current: insertedCount,\n      completed_at: new Date().toISOString(),\n      metadata: costMetadata,\n    }))\n    .eq('id', generationCycleId);\n\n  if (cycleUpdateError) {\n    console.error(`[glossary] ERROR: Failed to update generation cycle to completed: ${cycleUpdateError.message}`);\n    throw new Error(`Failed to update generation cycle: ${cycleUpdateError.message}`);\n  }\n\n  console.log(`[glossary] Inserted ${insertedCount} glossary terms for event ${eventId}`);\n  console.log(`[glossary] Generation cycle ${generationCycleId} marked as completed`);\n  return {\n    termCount: insertedCount,\n    costBreakdown,\n  };\n}\n\ninterface TermDefinition {\n  term: string;\n  definition: string;\n  acronym_for?: string;\n  category: string;\n  usage_examples?: string[];\n  related_terms?: string[];\n  confidence_score?: number;\n  source?: string;\n  source_url?: string;\n}\n\n/**\n * Generate definitions for terms using Exa /answer for high-priority terms, LLM for others\n */\nasync function generateTermDefinitions(\n  terms: Array<{ term: string; is_acronym: boolean; category: string; priority: number }>,\n  researchContext: string,\n  importantDetails: string,\n  openai: OpenAI,\n  genModel: string,\n  exa?: Exa,\n  costBreakdown?: GlossaryCostBreakdown\n): Promise<{ definitions: TermDefinition[]; batchCostBreakdown: GlossaryCostBreakdown }> {\n  const definitions: TermDefinition[] = [];\n  const termsForLLM: Array<{ term: string; is_acronym: boolean; category: string; priority: number }> = [];\n  \n  // Initialize batch cost breakdown\n  const batchCostBreakdown: GlossaryCostBreakdown = {\n    openai: {\n      total: 0,\n      chat_completions: [],\n    },\n    exa: {\n      total: 0,\n      answer: { cost: 0, queries: 0 },\n    },\n  };\n\n  // Process high-priority terms (priority <= 3) with Exa /answer if available\n  for (const term of terms) {\n    if (term.priority <= 3 && exa) {\n      try {\n        console.log(`[glossary] Using Exa /answer for high-priority term (priority ${term.priority}): ${term.term}`);\n        \n        const answer = await exa.answer(`What is ${term.term}?`, {\n          text: true,\n          systemPrompt: EXA_ANSWER_SYSTEM_PROMPT,\n        });\n\n        const answerText = typeof answer.answer === 'string' ? answer.answer.trim() : '';\n        if (answerText) {\n          // Extract source URL from citations if available\n          const sourceUrl = Array.isArray(answer.citations) && answer.citations.length > 0\n            ? answer.citations[0]?.url \n            : undefined;\n\n          // Transform Exa markdown answer into structured glossary format using LLM\n          const transformedDef = await transformExaAnswerToGlossary(\n            term.term,\n            term.is_acronym,\n            term.category,\n            answerText,\n            sourceUrl,\n            openai,\n            genModel\n          );\n\n          if (transformedDef) {\n            definitions.push(transformedDef);\n            console.log(`[glossary] Generated definition for \"${term.term}\" using Exa /answer (transformed to glossary format)`);\n            \n            // Track Exa answer cost\n            const answerCost = calculateExaAnswerCost(1);\n            batchCostBreakdown.exa.total += answerCost;\n            batchCostBreakdown.exa.answer.cost += answerCost;\n            batchCostBreakdown.exa.answer.queries += 1;\n            \n            continue; // Skip LLM generation for this term\n          } else {\n            console.warn(`[glossary] Failed to transform Exa answer for \"${term.term}\", falling back to LLM`);\n            // Fall through to LLM generation\n          }\n        }\n      // TODO: narrow unknown -> ExaAPIError after upstream callsite analysis\n      } catch (exaError: unknown) {\n        const message = exaError instanceof Error ? exaError.message : String(exaError);\n        console.warn(`[glossary] Exa /answer failed for term \"${term.term}\": ${message}. Falling back to LLM.`);\n        // Fall through to LLM generation\n      }\n    }\n\n    // Add to LLM batch if Exa wasn't used or failed\n    termsForLLM.push(term);\n  }\n\n  // Generate remaining terms with LLM\n  if (termsForLLM.length > 0) {\n    const systemPrompt = GLOSSARY_DEFINITION_SYSTEM_PROMPT;\n\n    const termsList = termsForLLM\n      .map((term: GlossaryPlanTerm) => `- ${term.term}${term.is_acronym ? ' (acronym)' : ''} - ${term.category}`)\n      .join('\\n');\n\n    const userPrompt = createGlossaryDefinitionUserPrompt(\n      termsList,\n      researchContext,\n      importantDetails\n    );\n\n    try {\n      // Some models (like o1, o1-preview, o1-mini, gpt-5) don't support custom temperature values\n      // Only set temperature if model supports custom values\n      // Check for models that only support default temperature (1) or don't support it at all\n      const modelLower = genModel.toLowerCase();\n      const isO1Model = modelLower.startsWith('o1');\n      const isGpt5Model = modelLower.includes('gpt-5') || modelLower.startsWith('gpt5');\n      const onlySupportsDefaultTemp = isO1Model || isGpt5Model;\n      const supportsCustomTemperature = !onlySupportsDefaultTemp;\n      \n      if (onlySupportsDefaultTemp) {\n        console.log(`[glossary] Model \"${genModel}\" only supports default temperature (1), skipping custom temperature setting`);\n      }\n      \n      // Build request options - conditionally include temperature\n      const requestOptions: ChatCompletionRequest = {\n        model: genModel,\n        messages: [\n          { role: 'system', content: systemPrompt },\n          { role: 'user', content: userPrompt },\n        ],\n        response_format: { type: 'json_object' },\n      };\n      \n      // Only add temperature if model supports custom temperature values\n      if (supportsCustomTemperature) {\n        requestOptions.temperature = 0.5; // Lower temperature for more consistent definitions\n      }\n      \n      const response = await openai.chat.completions.create(\n        requestOptions\n      ) as OpenAI.Chat.Completions.ChatCompletion;\n\n      // Track OpenAI cost\n      if (response.usage) {\n        const usage = response.usage;\n        const cost = calculateOpenAICost(usage, genModel, false);\n        batchCostBreakdown.openai.total += cost;\n        batchCostBreakdown.openai.chat_completions.push({\n          cost,\n          usage: {\n            prompt_tokens: usage.prompt_tokens,\n            completion_tokens: usage.completion_tokens,\n            total_tokens: usage.total_tokens,\n          },\n          model: genModel,\n        });\n      }\n\n      const content = response.choices[0]?.message?.content;\n      if (!content) {\n        throw new Error('Empty response from LLM');\n      }\n\n      const parsed: unknown = JSON.parse(content);\n      // Handle both \"definitions\" and \"terms\" keys (json_object format always returns object)\n      const llmDefinitions =\n        (parsed as { definitions?: unknown; terms?: unknown }).definitions ??\n        (parsed as { definitions?: unknown; terms?: unknown }).terms ??\n        [];\n\n      if (!Array.isArray(llmDefinitions)) {\n        throw new Error('LLM did not return array of definitions');\n      }\n\n      // Validate and normalize definitions\n      const normalizedLLMDefinitions = llmDefinitions.map((def: unknown) => {\n        const normalized = def as Partial<TermDefinition>;\n        return {\n          term: normalized.term || '',\n          definition: normalized.definition || '',\n          acronym_for: normalized.acronym_for || undefined,\n          category: normalized.category || 'general',\n          usage_examples: normalized.usage_examples || [],\n          related_terms: normalized.related_terms || [],\n          confidence_score: normalized.confidence_score || 0.8,\n          source: normalized.source || 'llm_generation',\n          source_url: normalized.source_url || undefined,\n        };\n      });\n\n      definitions.push(...normalizedLLMDefinitions);\n    // TODO: narrow unknown -> OpenAIAPIError after upstream callsite analysis\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : String(error);\n      console.error(`[glossary] Error generating LLM definitions: ${message}`);\n      // Return basic definitions on error\n      const fallbackDefinitions = termsForLLM.map((term: GlossaryPlanTerm) => ({\n        term: term.term,\n        definition: `Term: ${term.term}. Definition to be completed.`,\n        category: term.category,\n        confidence_score: 0.5,\n        source: 'llm_generation',\n      }));\n      definitions.push(...fallbackDefinitions);\n    }\n  }\n\n  // Merge batch costs into main cost breakdown if provided\n  if (costBreakdown) {\n    costBreakdown.openai.total += batchCostBreakdown.openai.total;\n    costBreakdown.openai.chat_completions.push(...batchCostBreakdown.openai.chat_completions);\n    costBreakdown.exa.total += batchCostBreakdown.exa.total;\n    costBreakdown.exa.answer.cost += batchCostBreakdown.exa.answer.cost;\n    costBreakdown.exa.answer.queries += batchCostBreakdown.exa.answer.queries;\n  }\n\n  return { definitions, batchCostBreakdown };\n}\n\n/**\n * Transform Exa markdown answer into structured glossary format\n * Extracts clean definition, usage examples, and related terms\n */\nasync function transformExaAnswerToGlossary(\n  term: string,\n  isAcronym: boolean,\n  category: string,\n  exaAnswer: string,\n  sourceUrl: string | undefined,\n  openai: OpenAI,\n  genModel: string\n): Promise<TermDefinition | null> {\n  try {\n    const systemPrompt = EXA_ANSWER_TRANSFORM_SYSTEM_PROMPT;\n    const termDescriptor = `- ${term}${isAcronym ? ' (acronym)' : ''} - ${category}`;\n    const userPrompt = createExaAnswerTransformUserPrompt(termDescriptor, exaAnswer);\n\n    // Some models (like o1, o1-preview, o1-mini, gpt-5) don't support custom temperature values\n    const modelLower = genModel.toLowerCase();\n    const isO1Model = modelLower.startsWith('o1');\n    const isGpt5Model = modelLower.includes('gpt-5') || modelLower.startsWith('gpt5');\n    const onlySupportsDefaultTemp = isO1Model || isGpt5Model;\n    const supportsCustomTemperature = !onlySupportsDefaultTemp;\n\n    const requestOptions: ChatCompletionRequest = {\n      model: genModel,\n      messages: [\n        { role: 'system', content: systemPrompt },\n        { role: 'user', content: userPrompt },\n      ],\n      response_format: { type: 'json_object' },\n    };\n\n    if (supportsCustomTemperature) {\n      requestOptions.temperature = 0.3; // Low temperature for consistent transformation\n    }\n\n    const response = await openai.chat.completions.create(\n      requestOptions\n    ) as OpenAI.Chat.Completions.ChatCompletion;\n    const content = response.choices[0]?.message?.content;\n\n    if (!content) {\n      console.warn(`[glossary] Empty response when transforming Exa answer for \"${term}\"`);\n      return null;\n    }\n\n    try {\n      const parsed = JSON.parse(content) as {\n        term?: string;\n        definition?: string;\n        acronym_for?: string;\n        category?: string;\n        usage_examples?: string[];\n        related_terms?: string[];\n      };\n\n      if (!parsed.definition || !parsed.definition.trim()) {\n        console.warn(`[glossary] Missing definition in transformed Exa answer for \"${term}\"`);\n        return null;\n      }\n\n      return {\n        term: parsed.term || term,\n        definition: parsed.definition.trim(),\n        acronym_for: parsed.acronym_for || undefined,\n        category: parsed.category || category,\n        usage_examples: parsed.usage_examples || [],\n        related_terms: parsed.related_terms || [],\n        confidence_score: 0.9, // High confidence for Exa answers\n        source: 'exa',\n        source_url: sourceUrl,\n      };\n    // TODO: narrow unknown -> SyntaxError after upstream callsite analysis\n    } catch (parseError: unknown) {\n      const message = parseError instanceof Error ? parseError.message : String(parseError);\n      console.warn(`[glossary] Failed to parse transformed Exa answer for \"${term}\": ${message}`);\n      return null;\n    }\n  // TODO: narrow unknown -> OpenAIAPIError after upstream callsite analysis\n  } catch (error: unknown) {\n    const message = error instanceof Error ? error.message : String(error);\n    console.warn(`[glossary] Error transforming Exa answer for \"${term}\": ${message}`);\n    return null;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/will-liao/Desktop/Coding/Git/jarvis/worker/context/pipeline/pricing-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]